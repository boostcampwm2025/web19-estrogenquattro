(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{366:(e,t,s)=>{"use strict";s.d(t,{default:()=>N});var r=s(546),i=s(842),a=s(6346),n=s(8986);function o(e){let t=Math.floor(e/60),s="⏱️";if(t<60)s+=`${t}분`;else{let e=Math.floor(t/60),r=t%60;s+=`${e}시간`,r>0&&(s+=` ${r}분`)}return s}var l=s(7518);let d="stop";class c{constructor(e){this.sprite=null,this.currentDirection=d,this.offset={x:35,y:0},this.DISTANCE_X=35,this.DISTANCE_Y=50,this.BODY_CENTER_Y=5,this.scene=e,e.textures.exists("pet")&&(this.sprite=e.add.image(this.offset.x,this.offset.y,"pet"),this.sprite.setDisplaySize(64,64),this.sprite.setOrigin(.5,.5),this.sprite.setDepth(-1))}getSprite(){return this.sprite}updatePosition(e){if(!this.sprite||e===this.currentDirection)return;this.currentDirection=e;let t=0,s=this.BODY_CENTER_Y+this.DISTANCE_Y;switch(e){case"left":t=this.DISTANCE_X,s=this.BODY_CENTER_Y;break;case"right":t=-this.DISTANCE_X,s=this.BODY_CENTER_Y;break;case"up":t=0,s=this.BODY_CENTER_Y+this.DISTANCE_Y;break;case"down":t=0,s=this.BODY_CENTER_Y-this.DISTANCE_Y;break;case"left-up":t=this.DISTANCE_X,s=this.BODY_CENTER_Y+this.DISTANCE_X;break;case"left-down":t=this.DISTANCE_X,s=this.BODY_CENTER_Y-this.DISTANCE_X;break;case"right-up":t=-this.DISTANCE_X,s=this.BODY_CENTER_Y+this.DISTANCE_X;break;case"right-down":t=-this.DISTANCE_X,s=this.BODY_CENTER_Y-this.DISTANCE_X;break;default:return}this.scene.tweens.add({targets:this.sprite,x:t,y:s,duration:150,ease:"Power2"}),this.offset={x:t,y:s}}destroy(){this.sprite&&(this.sprite.destroy(),this.sprite=null)}}class h{constructor(e,t,s,r,i,n="face"){this.bodyGlow=null,this.taskBubbleContainer=null,this.speed=300,this.scene=e,this.id=i,this.username=r,this.container=e.add.container(t,s),this.bodySprite=e.add.sprite(0,5,"body"),this.bodySprite.setFrame(0),this.maskShape=e.make.graphics({}),this.maskShape.fillStyle(0xffffff),this.maskShape.fillCircle(0,0,17),this.maskShape.x=t,this.maskShape.y=s;const d=this.maskShape.createGeometryMask(),h=e.textures.exists(n)?n:"face";this.faceSprite=e.add.image(0,0,h),this.faceSprite.setDisplaySize(34,34),this.faceSprite.setMask(d),this.borderGraphics=e.add.graphics(),this.borderGraphics.lineStyle(2,0xffffff,1),this.borderGraphics.strokeCircle(0,0,17);const u=e.add.text(0,50,r,{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"12px",color:"#ffffff",backgroundColor:"#00000088",padding:{x:4,y:2}}).setOrigin(.5).setResolution(2);this.focusTimeText=e.add.text(0,66,o(0),{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"10px",color:"#ffffff",backgroundColor:"#00000088",padding:{x:4,y:2}}).setOrigin(.5).setResolution(2),this.pet=new c(e);const m=[this.bodySprite,this.faceSprite,this.borderGraphics,u,this.focusTimeText],p=this.pet.getSprite();p&&m.unshift(p),this.container.add(m),this.container.setSize(34,51),e.physics.world.enable(this.container),this.body=this.container.body,this.body.setCollideWorldBounds(!0),this.body.setSize(34,8.5),this.body.setOffset(0,50),this.container.setInteractive(new a.Geom.Rectangle(0,10,34,51),a.Geom.Rectangle.Contains),this.bodySprite.preFX&&(this.bodyGlow=this.bodySprite.preFX.addGlow(0xffff00,4,0,!1),this.bodyGlow.active=!1),this.container.on("pointerdown",()=>{l.U.getState().openModal(this.id,this.username)}),this.container.on("pointerover",()=>{this.scene.game.canvas.style.cursor="pointer",this.borderGraphics.clear(),this.borderGraphics.lineStyle(3,0xffff00,1),this.borderGraphics.strokeCircle(0,0,17),this.bodyGlow&&(this.bodyGlow.active=!0)}),this.container.on("pointerout",()=>{this.scene.game.canvas.style.cursor="default",this.borderGraphics.clear(),this.borderGraphics.lineStyle(2,0xffffff,1),this.borderGraphics.strokeCircle(0,0,17),this.bodyGlow&&(this.bodyGlow.active=!1)})}update(){this.container&&this.maskShape&&(this.maskShape.x=this.container.x,this.maskShape.y=this.container.y)}updatePetPosition(e){this.pet.updatePosition(e)}updateFocusTime(e){this.focusTimeText&&this.focusTimeText.setText(o(e))}getPosition(){return{x:this.container.x,y:this.container.y}}getContainer(){return this.container}destroy(){this.pet.destroy(),this.container.destroy(),this.maskShape.destroy()}updateFaceTexture(e){this.faceSprite&&this.scene.textures.exists(e)&&(this.faceSprite.setTexture(e),this.faceSprite.setDisplaySize(34,34))}playAnimation(e,t=!0){this.bodySprite&&this.bodySprite.play(e,t)}stopAnimation(){this.bodySprite&&this.bodySprite.stop()}updateTaskBubble(e){this.taskBubbleContainer&&(this.taskBubbleContainer.destroy(),this.taskBubbleContainer=null);let{isFocusing:t,taskName:s}=e;this.taskBubbleContainer=this.scene.add.container(0,-40),this.taskBubbleContainer.setName("taskBubble");let r=[],i=this.scene.add.graphics();i.fillStyle(t?2278750:0xef4444,1);let a=this.scene.add.text(0,0,t?"작업 중":"휴식 중",{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"10px",color:t?"#166534":"#991b1b"});a.setResolution(2),a.setOrigin(0,.5),r.push(i,a);let n=null;if(t&&s){let e=s.length>30?s.slice(0,30)+"...":s;(n=this.scene.add.text(0,0,e,{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"9px",color:"#374151"})).setResolution(2),n.setOrigin(.5,.5),r.push(n)}let o=Math.max(11+a.width,n?n.width+24:0)+16,l=n?32:18,d=this.scene.add.graphics();if(d.fillStyle(t?0xdcfce7:0xfee2e2,1),d.lineStyle(1,t?8843180:0xfca5a5,1),d.fillRoundedRect(-o/2,-l/2,o,l,l/2),d.strokeRoundedRect(-o/2,-l/2,o,l,l/2),n){let e=-o/2+8+5+6;i.fillCircle(-o/2+8+2.5,-6,2.5),a.setPosition(e,-6),n.setOrigin(0,.5),n.setPosition(e,8)}else i.fillCircle(-o/2+8+2.5,0,2.5),a.setPosition(-o/2+8+5+6,0);this.taskBubbleContainer.add([d,...r]),this.container.add(this.taskBubbleContainer),this.container.bringToTop(this.taskBubbleContainer)}showChatBubble(e){let t=this.container.getByName("chatBubble");t&&t.destroy();let s=40*!!this.taskBubbleContainer,r=this.scene.add.container(0,-40-s);r.setName("chatBubble");let i=this.scene.add.text(0,0,e,{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"12px",color:"#000000",wordWrap:{width:150,useAdvancedWrap:!0}});i.setResolution(2),i.setOrigin(.5);let a=i.getBounds(),n=a.width+24,o=a.height+12,l=this.scene.add.graphics();l.fillStyle(0,.02),l.fillRoundedRect(-n/2+5,-o/2+5,n,o,10),l.fillStyle(0,.04),l.fillRoundedRect(-n/2+3,-o/2+4,n,o,10),l.fillStyle(0,.08),l.fillRoundedRect(-n/2+1,-o/2+2,n,o,10),l.fillStyle(0xffffff,1),l.lineStyle(1,0xd1d5db,1),l.fillRoundedRect(-n/2,-o/2,n,o,10),l.strokeRoundedRect(-n/2,-o/2,n,o,10),l.fillStyle(0xffffff,1),l.fillTriangle(-4,o/2-1,4,o/2-1,0,o/2+6),l.lineStyle(1.5,0xe5e7eb,1),l.lineBetween(-4,o/2,0,o/2+6),l.lineBetween(4,o/2,0,o/2+6),r.add([l,i]),this.container.add(r),this.scene.time.delayedCall(5e3,()=>{r.active&&r.destroy()}),this.container.bringToTop(r),this.taskBubbleContainer&&this.container.bringToTop(this.taskBubbleContainer)}}class u extends h{constructor(e,t,s,r,i,a){super(e,t,s,r,i,r),this.prevState={isMoving:!1,direction:d},this.roomId=a}setRoomId(e){this.roomId=e}update(e){if(super.update(),!this.body||!e)return;let t=0,s=0,r="",i="";e.left.isDown?(t=-this.speed,r="left"):e.right.isDown&&(t=this.speed,r="right"),e.up.isDown?(s=-this.speed,i="up"):e.down.isDown&&(s=this.speed,i="down"),this.body.setVelocity(t,s);let a=0!==t||0!==s;if(a){let e=this.body.blocked;"left"===r&&e.left&&(a=!1),"right"===r&&e.right&&(a=!1),"up"===i&&e.up&&(a=!1),"down"===i&&e.down&&(a=!1)}let o=d;if(a&&(r&&i?o=`${r}-${i}`:r?o=r:i&&(o=i)),a?"left"===r?this.playAnimation("walk-left"):"right"===r?this.playAnimation("walk-right"):"up"===i?this.playAnimation("walk-up"):"down"===i&&this.playAnimation("walk-down"):this.stopAnimation(),a!==this.prevState.isMoving||o!==this.prevState.direction){let e={roomId:this.roomId,userId:this.id,x:this.container.x,y:this.container.y,isMoving:a,direction:o,timestamp:Date.now()};(0,n.c)("moving",e),this.updatePetPosition(o),this.prevState={isMoving:a,direction:o}}}}var m=s(4563),p=s(4210);class g{constructor(e,t){this.currentMapIndex=0,this.tileSize=32,this.scene=e,this.maps=t}setup(){let e=this.maps[this.currentMapIndex],t=this.scene.add.image(0,0,e.image);t.setOrigin(0,0),t.setName("mapImage"),t.setDepth(-1),this.scene.physics.world.setBounds(0,0,t.width,t.height);let s=this.scene.make.tilemap({key:e.tilemap});this.walls=this.scene.physics.add.staticGroup();let r=s.getObjectLayer("Collisions");r&&r.objects.forEach(e=>{if(("class"in e&&"wall"===e.class||"wall"===e.type)&&void 0!==e.x&&void 0!==e.y){let t=this.scene.add.rectangle(e.x+(e.width||0)/2,e.y+(e.height||0)/2,e.width,e.height,0xff0000,0);t.setVisible(!1),this.walls?.add(t)}})}getMapImage(){return this.scene.children.getByName("mapImage")}getWalls(){return this.walls}getMapSize(){let e=this.getMapImage();return e?{width:e.width,height:e.height}:{width:0,height:0}}getTileSize(){return this.tileSize}switchToNextMap(e){this.currentMapIndex=(this.currentMapIndex+1)%this.maps.length,this.scene.cameras.main.fadeOut(500,0,0,0),this.scene.cameras.main.once("camerafadeoutcomplete",()=>{let t=this.scene.children.getByName("mapImage");t&&t.destroy(),this.walls?.clear(!0,!0),this.setup(),e(),this.scene.cameras.main.fadeIn(500,0,0,0)})}getCurrentMapIndex(){return this.currentMapIndex}destroy(){this.walls?.clear(!0,!0);let e=this.getMapImage();e&&e.destroy()}}var b=s(4902);class x extends h{constructor(e,t,s,r,i,a){super(e,t,s,r,i,a),this.isFocusing=!1,this.focusTimeTimer=null,this.totalFocusMinutes=0,this.currentSessionSeconds=0}setFocusState(e,t){this.isFocusing=e,this.totalFocusMinutes=t?.totalFocusMinutes??0,this.focusTimeTimer&&(this.focusTimeTimer.destroy(),this.focusTimeTimer=null),e?(this.currentSessionSeconds=t?.currentSessionSeconds??0,this.updateFocusTime(60*this.totalFocusMinutes+this.currentSessionSeconds),this.focusTimeTimer=this.scene.time.addEvent({delay:1e3,callback:()=>{this.currentSessionSeconds++,this.updateFocusTime(60*this.totalFocusMinutes+this.currentSessionSeconds)},loop:!0})):(this.currentSessionSeconds=0,this.updateFocusTime(60*this.totalFocusMinutes)),this.updateTaskBubble({isFocusing:e,taskName:t?.taskName})}getFocusState(){return this.isFocusing}destroy(){this.focusTimeTimer&&(this.focusTimeTimer.destroy(),this.focusTimeTimer=null),super.destroy()}updateState(e){this.body?(super.update(),a.Math.Distance.Between(this.container.x,this.container.y,e.x,e.y)>50&&this.container.setPosition(e.x,e.y),this.container.x=a.Math.Linear(this.container.x,e.x,.1),this.container.y=a.Math.Linear(this.container.y,e.y,.1),this.body.setVelocity(0),e.isMoving?(e.direction.includes("left")&&(this.body.setVelocityX(-this.speed),this.playAnimation("walk-left")),e.direction.includes("right")&&(this.body.setVelocityX(this.speed),this.playAnimation("walk-right")),e.direction.includes("up")&&(this.body.setVelocityY(-this.speed),this.playAnimation("walk-up")),e.direction.includes("down")&&(this.body.setVelocityY(this.speed),this.playAnimation("walk-down"))):(this.stopAnimation(),this.container.setPosition(e.x,e.y)),this.updatePetPosition(e.direction)):b.K.error("RemotePlayer body not found")}}class f{constructor(e,t,s){this.otherPlayers=new Map,this.roomId="",this.scene=e,this.username=t,this.getPlayer=s}setWalls(e){this.walls=e}setProgressBarController(e){this.progressBarController=e}setContributionController(e){this.contributionController=e}getRoomId(){return this.roomId}connect(e){let t=(0,n.cH)();if(!t)return;let s=this.getPlayer();t.on("connect",()=>{s&&t.id&&(s.id=t.id),t.emit("joining",{x:s?.getContainer().x,y:s?.getContainer().y,username:this.username})}),t.on("joined",e=>{this.roomId=e.roomId;let t=this.getPlayer();t&&t.setRoomId(e.roomId),e.focusTime&&m.O.getState().syncFromServer(e.focusTime)}),t.on("session_replaced",()=>{t.disconnect(),e()}),t.on("players_synced",e=>{e.forEach(e=>{this.addRemotePlayer(e)})}),t.on("player_joined",e=>{this.addRemotePlayer(e)}),t.on("moved",e=>{let t=this.otherPlayers.get(e.userId);t&&void 0!==e.isMoving&&void 0!==e.direction&&t.updateState({x:e.x,y:e.y,isMoving:e.isMoving,direction:e.direction})}),t.on("player_left",e=>{let t=this.otherPlayers.get(e.userId);t&&(t.destroy(),this.otherPlayers.delete(e.userId))}),t.on("github_state",e=>{this.progressBarController?.setProgress(e.progress),this.contributionController?.setContributions(e.contributions)}),t.on("github_event",e=>{let t=2*e.pushCount+5*e.pullRequestCount;if(t>0){this.progressBarController?.addProgress(t);let s=e.pushCount+e.pullRequestCount;this.contributionController?.addContribution(e.username,s)}}),t.on("chatted",e=>{let t=this.otherPlayers.get(e.userId);t&&t.showChatBubble(e.message)}),t.on("focused",e=>{if("FOCUSING"!==e.status)return;let t=this.otherPlayers.get(e.userId);t&&t.setFocusState(!0,{taskName:e.taskName,totalFocusMinutes:e.totalFocusMinutes??0,currentSessionSeconds:e.currentSessionSeconds??0})}),t.on("rested",e=>{if("RESTING"!==e.status)return;let t=this.otherPlayers.get(e.userId);t&&t.setFocusState(!1,{totalFocusMinutes:e.totalFocusMinutes??0})}),t.on("focus_task_updated",e=>{let t=this.otherPlayers.get(e.userId);t&&t.updateTaskBubble({isFocusing:!0,taskName:e.taskName})})}addRemotePlayer(e){if(this.otherPlayers.has(e.userId))return;let t=this.getPlayer();if(t&&t.id===e.userId)return;let s=e.username||"unknown",r=new x(this.scene,e.x,e.y,s,e.userId,s);if(this.otherPlayers.set(e.userId,r),r.setFocusState("FOCUSING"===e.status,{totalFocusMinutes:e.totalFocusMinutes??0,currentSessionSeconds:e.currentSessionSeconds??0}),this.walls&&this.scene.physics.add.collider(r.getContainer(),this.walls),!this.scene.textures.exists(s)){let e=`https://avatars.githubusercontent.com/${s}`;this.scene.load.image(s,e),this.scene.load.once(`filecomplete-image-${s}`,()=>{r.updateFaceTexture(s)}),this.scene.load.start()}}setupCollisions(){this.otherPlayers.forEach(e=>{this.walls&&this.scene.physics.add.collider(e.getContainer(),this.walls)})}getRemotePlayers(){return this.otherPlayers}updateRemotePlayers(){this.otherPlayers.forEach(e=>e.update())}sendChat(e){let t=this.getPlayer();if(!t)return;t.showChatBubble(e);let s=(0,n.Ol)();s&&s.emit("chatting",{message:e})}destroy(){this.otherPlayers.forEach(e=>e.destroy()),this.otherPlayers.clear()}}class y{constructor(e,t){this.input=null,this.scene=e,this.sendMessage=t}setup(){let e=document.getElementById("chat-input");e&&e.remove();let t=document.createElement("input");t.id="chat-input",t.type="text",t.className="absolute bottom-[100px] left-1/2 -translate-x-1/2 w-[320px] p-3 text-base border-4 border-gray-800 bg-white shadow-[4px_4px_0_0_rgba(0,0,0,0.5)] font-['NeoDunggeunmo',_Arial,_sans-serif] outline-none hidden z-[1000] placeholder:text-gray-400",t.placeholder="메시지를 입력하세요 (Enter로 전송)",document.body.appendChild(t),this.input=t,this.scene.input.keyboard?.on("keydown-ENTER",()=>{document.activeElement!==t&&(t.style.display="block",t.focus(),this.scene.input.keyboard.enabled=!1)}),t.addEventListener("keydown",e=>{e.stopPropagation(),"Enter"===e.key?(""!==t.value.trim()&&this.sendMessage(t.value),this.closeInput()):"Escape"===e.key&&this.closeInput()}),this.scene.events.on(a.Scenes.Events.SHUTDOWN,()=>{this.destroy()})}closeInput(){this.input&&(this.input.value="",this.input.style.display="none",this.input.blur(),setTimeout(()=>{this.scene&&this.scene.input&&this.scene.input.keyboard&&(this.scene.input.keyboard.enabled=!0)},100))}destroy(){this.input&&(this.input.remove(),this.input=null)}}class v{constructor(e){this.minZoom=.7,this.maxZoom=2,this.scene=e}setup(e,t,s){this.scene.cameras.main.setBounds(0,0,e,t),this.scene.cameras.main.centerOn(e/2,t/2),s&&this.scene.cameras.main.startFollow(s,!0,.05,.05),this.setInitialZoom(e,t),this.scene.input.on("wheel",this.handleZoom,this)}setInitialZoom(e,t){let s=Math.min(this.scene.scale.width/e,this.scene.scale.height/t);this.minZoom=s,this.scene.cameras.main.setZoom(s)}handleZoom(e,t,s,r){let i=this.scene.cameras.main.zoom,a=Math.max(this.minZoom,Math.min(this.maxZoom,i+(r>0?-.2:.2)));this.scene.cameras.main.setZoom(a)}updateBounds(e,t){this.scene.cameras.main.setBounds(0,0,e,t),this.setInitialZoom(e,t)}}class k extends a.Scene{constructor(){super({key:"MogakcoScene"}),this.username="",this.maps=[{image:"tiles1",tilemap:"tilemap1"},{image:"tiles2",tilemap:"tilemap2"}],this.lastTaskBubbleState=null}preload(){this.load.crossOrigin="anonymous",this.load.image("tiles1","/assets/maps/dessert_stage1.png"),this.load.tilemapTiledJSON("tilemap1","/assets/tilemaps/dessert_stage1.json"),this.load.image("tiles2","/assets/maps/dessert_stage2.png"),this.load.tilemapTiledJSON("tilemap2","/assets/tilemaps/dessert_stage2.json"),this.load.spritesheet("body","/assets/body.png",{frameWidth:64,frameHeight:64});let e=this.username||"boostcampwm2025";this.load.image("face",`https://avatars.githubusercontent.com/${e}`),this.load.svg("pet","/assets/mascot/gopher_stage1.svg",{width:512,height:512})}init(){let e=this.registry.get("user");this.username=e?.username}create(){this.mapManager=new g(this,this.maps),this.mapManager.setup(),this.createAnimations(),this.setupPlayer(),this.setupCollisions(),this.setupControls(),this.setupUI(),this.cameraController=new v(this);let{width:e,height:t}=this.mapManager.getMapSize();this.cameraController.setup(e,t,this.player?.getContainer()),this.socketManager=new f(this,this.username,()=>this.player),this.socketManager.setWalls(this.mapManager.getWalls()),this.socketManager.setProgressBarController(this.progressBarController),this.socketManager.setContributionController(this.contributionController),this.socketManager.connect(()=>this.showSessionEndedOverlay()),this.chatManager=new y(this,e=>this.socketManager.sendChat(e)),this.chatManager.setup()}createAnimations(){this.anims.exists("walk-down")||this.anims.create({key:"walk-down",frames:this.anims.generateFrameNumbers("body",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.exists("walk-left")||this.anims.create({key:"walk-left",frames:this.anims.generateFrameNumbers("body",{start:4,end:7}),frameRate:10,repeat:-1}),this.anims.exists("walk-right")||this.anims.create({key:"walk-right",frames:this.anims.generateFrameNumbers("body",{start:8,end:11}),frameRate:10,repeat:-1}),this.anims.exists("walk-up")||this.anims.create({key:"walk-up",frames:this.anims.generateFrameNumbers("body",{start:12,end:15}),frameRate:10,repeat:-1})}setupPlayer(){let{width:e,height:t}=this.mapManager.getMapSize(),s=this.mapManager.getTileSize(),r=Math.floor(e/2/s)*s+s/2,i=Math.floor(t/2/s)*s+s/2,a=(0,n.Ol)(),o=a?.id||`guest-${Math.floor(1e3*Math.random())}`;this.player=new u(this,r,i,this.username,o,"pending")}setupControls(){this.input.keyboard&&(this.cursors=this.input.keyboard.createCursorKeys(),this.xKey=this.input.keyboard.addKey(a.Input.Keyboard.KeyCodes.X))}setupUI(){var e;let t,s,r,i,a,n,o,l,d,c,{width:h}=this.mapManager.getMapSize();this.progressBarController&&this.progressBarController.destroy(),this.contributionController&&this.contributionController.destroy(),this.progressBarController=(e=this,t={width:384,height:24,x:h/2-192,y:50,radius:12,border:1},s=0,(r=e.add.graphics()).fillStyle(0xe5e7eb,1),r.fillRoundedRect(t.x,t.y,t.width,t.height,t.radius),r.lineStyle(t.border,2042167,1),r.strokeRoundedRect(t.x,t.y,t.width,t.height,t.radius),r.setDepth(1e3),(i=e.add.graphics()).setDepth(1001),(a=()=>{i.clear();let e=t.border+2,r=(t.width-2*e)*s/100,a=t.radius-e,n=t.height-2*e;if(r>0)if(i.fillStyle(4906624,1),r>=2*a)i.fillRoundedRect(t.x+e,t.y+e,r,n,a);else{let s=Math.max(r,a);i.fillRoundedRect(t.x+e,t.y+e,s,n,{tl:a,tr:0,bl:a,br:0})}})(),n=(t,r)=>{e.tweens.add({targets:{value:s},value:t,duration:300,ease:"Cubic.easeOut",onUpdate:e=>{let t=e.getValue();"number"==typeof t&&(s=t,a())},onComplete:()=>{r?.()}})},o={addProgress:t=>{n(Math.min(s+t,100),()=>{s>=100&&(o.onProgressComplete?.(),e.time.delayedCall(1e3,()=>{n(0)}))})},setProgress:e=>{s=Math.max(0,Math.min(100,e)),a()},reset:()=>{n(0)},getProgress:()=>s,destroy:()=>{r.destroy(),i.destroy()}}),this.progressBarController.onProgressComplete=()=>{this.mapManager.switchToNextMap(()=>{this.setupCollisions(),this.setupUI();let{width:e,height:t}=this.mapManager.getMapSize();this.cameraController.updateBounds(e,t),this.socketManager.setWalls(this.mapManager.getWalls()),this.socketManager.setupCollisions(),this.socketManager.setProgressBarController(this.progressBarController),this.socketManager.setContributionController(this.contributionController)})},this.contributionController=(l=new Map,(d=this.add.text(h/2,85,"",{fontSize:"14px",color:"#374151",fontFamily:"monospace"})).setOrigin(.5,0),d.setDepth(1e3),c=()=>{let e=Array.from(l.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5);if(0===e.length)return void d.setText("");let t=e.map(([e,t])=>`${e}:${t}`).join("  ");d.setText(t)},{addContribution:(e,t)=>{let s=l.get(e)||0;l.set(e,s+t),c()},setContributions:e=>{for(let[t,s]of(l.clear(),Object.entries(e)))l.set(t,s);c()},reset:()=>{l.clear(),c()},destroy:()=>{d.destroy()}})}setupCollisions(){let e=this.mapManager.getWalls();e&&this.player&&this.physics.add.collider(this.player.getContainer(),e)}showSessionEndedOverlay(){this.scene.pause();let e=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.7);e.setScrollFactor(0),e.setDepth(1e3);let t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"다른 탭에서 접속하여\n현재 세션이 종료되었습니다.",{fontSize:"24px",color:"#ffffff",align:"center"});t.setOrigin(.5),t.setScrollFactor(0),t.setDepth(1001)}update(){if(!this.player||!this.cursors)return;if(this.xKey&&a.Input.Keyboard.JustDown(this.xKey)){let e=100-(this.progressBarController?.getProgress()||0);e>0&&this.progressBarController?.addProgress(e)}let e=m.O.getState().focusTime;this.player.updateFocusTime(e),this.updateTaskBubble(),this.player.update(this.cursors),this.socketManager.updateRemotePlayers()}updateTaskBubble(){if(!this.player)return;let{isFocusTimerRunning:e}=m.O.getState(),t=p.d.getState().tasks.find(e=>e.isRunning),s=e||!!t,r=t?.description,i={isFocusing:s,taskName:r};(this.lastTaskBubbleState?.isFocusing!==i.isFocusing||this.lastTaskBubbleState?.taskName!==i.taskName)&&(this.lastTaskBubbleState=i,this.player.updateTaskBubble({isFocusing:s,taskName:r}))}}let w={type:a.AUTO,parent:"game-container",scale:{mode:a.Scale.RESIZE,width:"100%",height:"100%"},audio:{noAudio:!0},backgroundColor:"#303032",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[k]};var j=s(9873);function N(){let{user:e}=(0,j.n)(),t=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!t.current)return t.current=new a.Game(w),e&&t.current.registry.set("user",e),()=>{t.current&&(t.current.destroy(!0),t.current=null)}},[e]),(0,r.jsx)("div",{id:"game-container",className:"h-full w-full"})}},486:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(546);let i=(0,s(3059).default)(()=>Promise.resolve(({children:e})=>(0,r.jsx)(r.Fragment,{children:e})),{ssr:!1})},982:(e,t,s)=>{"use strict";s.d(t,{$:()=>i});var r=s(546);function i({className:e="",children:t,...s}){return(0,r.jsx)("button",{className:e,...s,children:t})}s(842)},3924:(e,t,s)=>{"use strict";s.d(t,{default:()=>T});var r=s(546),i=s(842),a=s(5355),n=s(8742),o=s(4958),l=s(8601),d=s(982);function c({message:e}){return e?(0,r.jsx)("div",{role:"alert",className:"border-retro-border-darkest bg-retro-border-light text-retro-delete-hover shadow-retro-sm mb-3 rounded-none border-2 px-3 py-2 text-xs",children:e}):null}function h({time:e,isRunning:t,onToggle:s,error:i}){return(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"text-md text-retro-text-primary mb-3",children:"[ Focus Time ]"}),(0,r.jsx)(c,{message:i}),(0,r.jsx)("div",{className:"border-retro-border-dark bg-retro-bg-secondary shadow-retro-md mb-4 rounded-none border-3 p-6",children:(0,r.jsx)("div",{className:"text-retro-text-primary text-center text-3xl",children:e})}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(d.$,{onClick:s,className:"border-retro-border-darker bg-retro-button-bg text-retro-button-text shadow-retro-lg hover:bg-retro-button-hover flex flex-1 items-center justify-center gap-2 rounded-none border-2 py-2 transition-all active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"h-4 w-4"}),"정지"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A,{className:"h-4 w-4"}),"시작"]})})})]})}var u=s(364),m=s(1696),p=s(4652),g=s(3798),b=s(5371),x=s(249);function f({checked:e=!1,disabled:t=!1,onCheckedChange:s,className:i=""}){return(0,r.jsx)("input",{type:"checkbox",checked:e,disabled:t,onChange:e=>s?.(e.target.checked),className:i})}function y({className:e="",...t}){return(0,r.jsx)("input",{className:e,...t})}function v({task:e,isPending:t,onToggle:s,onDelete:a,onToggleTimer:n,onEdit:c,formatTime:h}){let[u,v]=(0,i.useState)(!1),[k,w]=(0,i.useState)(e.description);return(0,r.jsxs)("div",{className:"group border-retro-border-dark bg-retro-bg-secondary shadow-retro-sm hover:border-retro-border-darker flex items-center gap-3 rounded-none border-2 px-3 py-3 transition-colors",children:[(0,r.jsx)(f,{checked:e.completed,disabled:t,onCheckedChange:()=>s(e.id),className:"data-[state=checked]:border-retro-border-darker data-[state=checked]:bg-retro-button-bg border-retro-border-dark h-5 w-5 rounded-none border-2 disabled:cursor-not-allowed disabled:opacity-50"}),(0,r.jsx)("div",{className:"min-w-0 flex-1",children:u?(0,r.jsxs)("form",{onSubmit:s=>{s.preventDefault(),!t&&k.trim()&&(c(e.id,k.trim()),v(!1))},className:"flex gap-2",children:[(0,r.jsx)(y,{type:"text",value:k,onChange:e=>w(e.target.value),onKeyDown:e=>e.stopPropagation(),className:"border-retro-border-dark text-retro-text-primary h-8 flex-1 rounded-none border-2 bg-white px-2 text-sm disabled:cursor-not-allowed disabled:opacity-50",autoFocus:!0,disabled:t}),(0,r.jsx)(d.$,{type:"submit",disabled:t,className:"border-retro-border-darker bg-retro-button-bg text-retro-button-text hover:bg-retro-button-hover flex h-8 w-8 items-center justify-center rounded-none border-2 disabled:cursor-not-allowed disabled:opacity-50",children:(0,r.jsx)(m.A,{className:"h-4 w-4"})}),(0,r.jsx)(d.$,{type:"button",disabled:t,className:"border-retro-border-darker bg-retro-border-light text-retro-button-text hover:bg-retro-button-bg flex h-8 w-8 items-center justify-center rounded-none border-2 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{w(e.description),v(!1)},children:(0,r.jsx)(p.A,{className:"h-4 w-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:`text-sm ${e.completed?"text-retro-text-tertiary line-through":"text-retro-text-primary"}`,children:e.description}),(0,r.jsx)("div",{className:"text-retro-text-secondary mt-0.5 text-xs",children:h(e.time)})]})}),t&&(0,r.jsx)(g.A,{className:"text-retro-text-secondary h-4 w-4 animate-spin"}),!u&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(d.$,{disabled:t,className:`flex h-8 w-8 items-center justify-center rounded-none border-2 transition-all ${e.isRunning?"border-retro-border-darker bg-retro-button-bg text-retro-button-text hover:bg-retro-button-hover":"border-retro-border-dark text-retro-text-secondary hover:bg-retro-hover-bg hover:text-retro-border-darker bg-transparent"} disabled:cursor-not-allowed disabled:opacity-50`,onClick:()=>n(e.id),children:e.isRunning?(0,r.jsx)(o.A,{className:"h-4 w-4"}):(0,r.jsx)(l.A,{className:"h-4 w-4"})}),(0,r.jsx)(d.$,{disabled:t,className:"border-retro-border-light text-retro-text-secondary hover:bg-retro-hover-bg hover:text-retro-border-darker flex h-8 w-8 items-center justify-center rounded-none border-2 bg-transparent transition-all disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{v(!0),w(e.description)},children:(0,r.jsx)(b.A,{className:"h-4 w-4"})}),(0,r.jsx)(d.$,{disabled:t,className:"border-retro-border-light text-retro-text-secondary hover:bg-retro-hover-darker hover:text-retro-delete-hover flex h-8 w-8 items-center justify-center rounded-none border-2 bg-transparent transition-all disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>a(e.id),children:(0,r.jsx)(x.A,{className:"h-4 w-4"})})]})]})}function k({tasks:e,completedCount:t,totalCount:s,error:a,pendingTaskIds:n,onAddTask:o,onToggleTask:l,onDeleteTask:h,onToggleTaskTimer:g,onEditTask:b,formatTaskTime:x}){let[f,k]=(0,i.useState)(""),[w,j]=(0,i.useState)(!1);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-md text-retro-text-primary",children:"[ Tasks ]"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-retro-text-primary text-sm",children:[t,"/",s]}),(0,r.jsx)(d.$,{onClick:()=>{j(!0)},className:"border-retro-border-darker bg-retro-button-bg text-retro-button-text shadow-retro-md hover:bg-retro-button-hover flex h-7 w-7 items-center justify-center rounded-none border-2 transition-all active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,r.jsx)(u.A,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(c,{message:a}),w&&(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault(),f.trim()&&(o(f.trim()),k(""),j(!1))},className:"mb-3",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(y,{type:"text",value:f,onChange:e=>k(e.target.value),onKeyDown:e=>e.stopPropagation(),placeholder:"새 작업...",className:"border-retro-border-dark text-retro-text-primary placeholder:text-retro-text-tertiary flex-1 rounded-none border-2 bg-white px-3 py-2",autoFocus:!0}),(0,r.jsx)(d.$,{type:"submit",className:"border-retro-border-darker bg-retro-button-bg text-retro-button-text shadow-retro-md hover:bg-retro-button-hover flex h-8 w-8 items-center justify-center rounded-none border-2 active:shadow-none",children:(0,r.jsx)(m.A,{className:"h-4 w-4"})}),(0,r.jsx)(d.$,{type:"button",className:"border-retro-border-darker bg-retro-border-light text-retro-button-text shadow-retro-md hover:bg-retro-button-bg flex h-8 w-8 items-center justify-center rounded-none border-2 active:shadow-none",onClick:()=>{k(""),j(!1)},children:(0,r.jsx)(p.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,r.jsx)(v,{task:e,isPending:n.includes(e.id),onToggle:l,onDelete:h,onToggleTimer:g,onEdit:b,formatTime:x},e.id))})]})}let w=e=>{let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`};var j=s(4563),N=s(4210),S=s(2983);function T(){let e,t,[s,o]=(0,i.useState)(!0),{tasks:l,isLoading:d,error:c,pendingTaskIds:u,fetchTasks:m,addTask:p,toggleTask:g,deleteTask:b,editTask:x,toggleTaskTimer:f,stopAllTasks:y,incrementTaskTime:v,clearTaskError:T}=(0,N.d)((0,S.k)(e=>({tasks:e.tasks,isLoading:e.isLoading,error:e.error,pendingTaskIds:e.pendingTaskIds,fetchTasks:e.fetchTasks,addTask:e.addTask,toggleTask:e.toggleTask,deleteTask:e.deleteTask,editTask:e.editTask,toggleTaskTimer:e.toggleTaskTimer,stopAllTasks:e.stopAllTasks,incrementTaskTime:e.incrementTaskTime,clearTaskError:e.clearError})));(0,i.useEffect)(()=>{m()},[m]),(0,i.useEffect)(()=>{if(!c)return;let e=window.setTimeout(()=>{T()},3e3);return()=>{window.clearTimeout(e)}},[c,T]);let C=(0,i.useMemo)(()=>l.filter(e=>e.completed).length,[l]),M=(0,i.useMemo)(()=>l.find(e=>e.isRunning),[l]),{focusTime:E,incrementFocusTime:I,isFocusTimerRunning:_,startFocusing:D,stopFocusing:F,focusError:R,clearFocusError:P}=(0,j.O)((0,S.k)(e=>({focusTime:e.focusTime,incrementFocusTime:e.incrementFocusTime,isFocusTimerRunning:e.isFocusTimerRunning,startFocusing:e.startFocusing,stopFocusing:e.stopFocusing,focusError:e.error,clearFocusError:e.clearError}))),$=_||!!M;return(0,i.useEffect)(()=>{let e;return $&&(e=window.setInterval(()=>{I()},1e3)),()=>{e&&clearInterval(e)}},[$,I]),(0,i.useEffect)(()=>{if(!R)return;let e=window.setTimeout(()=>{P()},3e3);return()=>{window.clearTimeout(e)}},[R,P]),(0,i.useEffect)(()=>{let e;return M&&(e=window.setInterval(()=>{v(M.id)},1e3)),()=>{e&&clearInterval(e)}},[M,v]),(0,r.jsx)("div",{className:"w-md",children:(0,r.jsxs)("div",{className:"border-retro-border-dark bg-retro-bg-primary shadow-retro-xl rounded-none border-4 p-6",children:[(0,r.jsxs)("div",{className:`flex cursor-pointer items-center justify-between transition-all duration-300 select-none ${s?"mb-6":"mb-0"}`,onClick:()=>o(!s),children:[(0,r.jsx)("h1",{className:"text-retro-text-primary text-lg",children:"► TASKS"}),(0,r.jsx)("button",{className:"text-retro-text-primary hover:text-retro-text-secondary cursor-pointer transition-colors",children:s?(0,r.jsx)(a.A,{className:"h-5 w-5"}):(0,r.jsx)(n.A,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:`transition-all duration-300 ease-in-out ${s?"max-h-500 opacity-100":"max-h-0 overflow-hidden opacity-0"}`,children:[(0,r.jsx)(h,{time:(e=Math.floor(E/3600),t=Math.floor(E%3600/60),`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(E%60).padStart(2,"0")}`),isRunning:$,onToggle:()=>{$?(F(),y()):D()},error:R}),(0,r.jsx)(k,{tasks:l,completedCount:C,totalCount:l.length,onAddTask:p,onToggleTask:g,onDeleteTask:b,onToggleTaskTimer:e=>{let t=l.find(t=>t.id===e);t&&t.isRunning?F():D(t?.description),f(e)},onEditTask:x,formatTaskTime:w,error:c,pendingTaskIds:u})]})]})})}},4210:(e,t,s)=>{"use strict";s.d(t,{d:()=>d});var r=s(7122);function i(e){return{id:e.id,description:e.description,completed:e.isCompleted,time:60*e.totalFocusMinutes,isRunning:!1,createdDate:e.createdDate}}var a=s(4902);async function n(e,t){try{let s=await fetch(`http://138.2.116.232:8080${e}`,{...t,credentials:"include",headers:{"Content-Type":"application/json",...t?.headers}}),r=await s.text();if(!s.ok){let e=`API Error: ${s.status}`;if(r)try{let t=JSON.parse(r),s=t&&"string"==typeof t&&t||t&&"object"==typeof t&&(t.message??t.error??t.detail);s&&(Array.isArray(s)?e+=` - ${s.join(", ")}`:"string"==typeof s?e+=` - ${s}`:e+=` - ${JSON.stringify(s)}`)}catch{let t=r.length>200?`${r.slice(0,197)}...`:r;e+=` - ${t}`}throw Error(e)}return r?JSON.parse(r):{}}catch(s){throw a.K.error("fetchApi failed",{endpoint:e,method:t?.method??"GET",error:s}),s}}var o=s(4563),l=s(8986);let d=(0,r.v)((e,t)=>{let s=e=>t().pendingTaskIds.includes(e),r=t=>e(e=>({pendingTaskIds:e.pendingTaskIds.includes(t)?e.pendingTaskIds:[...e.pendingTaskIds,t]})),d=t=>e(e=>({pendingTaskIds:e.pendingTaskIds.filter(e=>e!==t)}));return{tasks:[],isLoading:!1,error:null,pendingTaskIds:[],clearError:()=>e({error:null}),fetchTasks:async t=>{e({isLoading:!0,error:null});try{let s,r=(await (s=t,n(`/api/tasks${s?`?date=${s}`:""}`))).tasks.map(i);e({tasks:r,isLoading:!1})}catch(s){a.K.error("Failed to fetch tasks",{date:t,error:s}),e({error:"Task 목록을 불러오는데 실패했습니다.",isLoading:!1})}},addTask:async t=>{let s=t.trim();if(!s)return void e({error:"Task 내용을 입력해주세요."});if(s.length>100)return void e({error:"Task는 100자 이하로 입력해주세요."});try{let t,r=await (t=s,n("/api/tasks",{method:"POST",body:JSON.stringify({description:t})})),a=i(r);e(e=>({tasks:[...e.tasks,a],error:null}))}catch(t){a.K.error("Failed to create task",{error:t}),e({error:"Task 생성에 실패했습니다."})}},toggleTask:async i=>{if(s(i))return;let{tasks:o}=t(),l=o.find(e=>e.id===i);if(l){e({error:null}),r(i),e(e=>({tasks:e.tasks.map(e=>e.id===i?{...e,completed:!e.completed}:e)}));try{let e,t;l.completed?await (e=i,n(`/api/tasks/uncompletion/${e}`,{method:"PATCH"})):await (t=i,n(`/api/tasks/completion/${t}`,{method:"PATCH"}))}catch(t){a.K.error("Failed to toggle task",{id:i,error:t}),e(e=>({tasks:e.tasks.map(e=>e.id===i?{...e,completed:l.completed}:e),error:"Task 상태 변경에 실패했습니다."}))}finally{d(i)}}},deleteTask:async i=>{if(s(i))return;let{tasks:o}=t(),l=o.findIndex(e=>e.id===i),c=l>=0?o[l]:void 0;if(c){e({error:null}),r(i),e(e=>({tasks:e.tasks.filter(e=>e.id!==i)}));try{let e;await (e=i,n(`/api/tasks/${e}`,{method:"DELETE"}))}catch(t){a.K.error("Failed to delete task",{id:i,error:t}),e(e=>({tasks:[...e.tasks.slice(0,l),c,...e.tasks.slice(l)],error:"Task 삭제에 실패했습니다."}))}finally{d(i)}}},editTask:async(i,c)=>{let h=c.trim();if(!h)return void e({error:"Task 내용을 입력해주세요."});if(h.length>100)return void e({error:"Task는 100자 이하로 입력해주세요."});if(s(i))return;let{tasks:u}=t(),m=u.find(e=>e.id===i);if(!m)return;e({error:null}),r(i);let p=m.description;e(e=>({tasks:e.tasks.map(e=>e.id===i?{...e,description:h}:e)}));try{let e,t;if(await (e=i,t=h,n(`/api/tasks/${e}`,{method:"PATCH",body:JSON.stringify({description:t})})),m.isRunning){let{status:e}=o.O.getState();if("FOCUSING"===e){let e=(0,l.Ol)();e?.connected&&e.emit("focus_task_updating",{taskName:h})}}}catch(t){a.K.error("Failed to update task",{id:i,error:t}),e(e=>({tasks:e.tasks.map(e=>e.id===i?{...e,description:p}:e),error:"Task 수정에 실패했습니다."}))}finally{d(i)}},toggleTaskTimer:t=>e(e=>({tasks:e.tasks.map(e=>e.id===t?{...e,isRunning:!e.isRunning}:{...e,isRunning:!1})})),stopAllTasks:()=>e(e=>({tasks:e.tasks.map(e=>({...e,isRunning:!1}))})),incrementTaskTime:t=>e(e=>({tasks:e.tasks.map(e=>e.id===t?{...e,time:e.time+1}:e)}))}})},4563:(e,t,s)=>{"use strict";s.d(t,{O:()=>a});var r=s(7122),i=s(8986);let a=(0,r.v)(e=>({focusTime:0,isFocusTimerRunning:!1,status:"RESTING",error:null,setFocusTime:t=>e({focusTime:t}),incrementFocusTime:()=>e(e=>({focusTime:e.focusTime+1})),resetFocusTime:()=>e({focusTime:0}),setFocusTimerRunning:t=>e({isFocusTimerRunning:t}),clearError:()=>e({error:null}),startFocusing:t=>{let s=(0,i.Ol)();s?.connected?(s.emit("focusing",{taskName:t}),e({status:"FOCUSING",isFocusTimerRunning:!0,error:null})):e({error:"서버와 연결되지 않았습니다. 잠시 후 다시 시도해주세요."})},stopFocusing:()=>{let t=(0,i.Ol)();t?.connected?(t.emit("resting"),e({status:"RESTING",isFocusTimerRunning:!1,error:null})):e({error:"서버와 연결되지 않았습니다. 잠시 후 다시 시도해주세요."})},syncFromServer:t=>{let s="FOCUSING"===t.status,r=60*t.totalFocusMinutes+(s?t.currentSessionSeconds:0);e({status:t.status,isFocusTimerRunning:s,focusTime:r,error:null})}}))},4902:(e,t,s)=>{"use strict";s.d(t,{K:()=>r});let r={error:(...e)=>{},warn:(...e)=>{},info:(...e)=>{},log:(...e)=>{}}},7351:(e,t,s)=>{Promise.resolve().then(s.bind(s,8450)),Promise.resolve().then(s.bind(s,486)),Promise.resolve().then(s.bind(s,366)),Promise.resolve().then(s.bind(s,3924)),Promise.resolve().then(s.bind(s,8098))},7518:(e,t,s)=>{"use strict";s.d(t,{U:()=>r});let r=(0,s(7122).v)(e=>({isOpen:!1,targetUserId:null,targetUsername:null,openModal:(t,s)=>e({isOpen:!0,targetUserId:t,targetUsername:s}),closeModal:()=>e({isOpen:!1,targetUserId:null,targetUsername:null})}))},8098:(e,t,s)=>{"use strict";s.d(t,{default:()=>P});var r=s(546),i=s(7518);let a=(0,s(7122).v)((e,t)=>({points:1e3,addPoints:t=>e(e=>({points:e.points+t})),subtractPoints:s=>{let r=t().points;return!(r<s)&&(e({points:r-s}),!0)},setPoints:t=>e({points:t})}));var n=s(842),o=s(4581),l=s(2688),d=s(982);function c(e,t){return!!t&&e.toDateString()===t.toDateString()}function h(e){let t=new Date,s=new Date(t);return s.setDate(t.getDate()-e),{startDate:s,endDate:t}}function u({day:e,position:t}){return(0,r.jsxs)("div",{className:"pointer-events-none fixed z-50 rounded-none border-2 border-amber-700 bg-amber-900 px-3 py-2 text-sm text-amber-50 shadow-[2px_2px_0px_0px_#000]",style:{left:t.x+10,top:t.y+10},children:[(0,r.jsx)("div",{children:e.date.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"short"})}),(0,r.jsxs)("div",{className:"mt-1 text-amber-300",children:["Point: ",e.value]})]})}function m({dailyTaskCounts:e,onSelectDate:t,selectedDate:s}){let i,a,[h,m]=(0,n.useState)(0),[p,g]=(0,n.useState)(null),[b,x]=(0,n.useState)({x:0,y:0}),f=(0,n.useRef)(null),{weeks:y}=(i=(0,n.useMemo)(()=>{let t=new Map;e.forEach(e=>{t.set(e.date,e.taskCount)});let s=[],r=new Date,i=new Date(r);i.setFullYear(r.getFullYear()-1);for(let e=new Date(i);e<=r;e.setDate(e.getDate()+1)){let r=e.toISOString().split("T")[0];s.push({date:new Date(e),value:t.get(r)||0})}return s},[e]),a=(0,n.useMemo)(()=>{let e=[],t=[],s=i[0].date.getDay();for(let e=0;e<s;e++)t.push({date:new Date(0),value:-1});if(i.forEach(s=>{t.push(s),7===t.length&&(e.push(t),t=[])}),t.length>0){for(;t.length<7;)t.push({date:new Date(0),value:-1});e.push(t)}return e},[i]),{yearData:i,weeks:a}),v=e=>{let t=f.current;if(!t)return;let s="left"===e?Math.max(0,h-200):Math.min(t.scrollWidth-t.clientWidth,h+200);m(s),t.scrollTo({left:s,behavior:"smooth"})},k=(e,t)=>{-1!==t.value&&(g(t),x({x:e.clientX,y:e.clientY}))},w=()=>{g(null)};return(0,n.useEffect)(()=>{let e=f.current;if(!e)return;let t=e.scrollWidth-e.clientWidth;e.scrollTo({left:t,behavior:"auto"}),m(t)},[]),(0,r.jsxs)("div",{className:"mb-6 rounded-none border-2 border-amber-800/20 bg-amber-50 p-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.$,{onClick:()=>v("left"),className:"h-7 w-7 shrink-0 rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,r.jsx)(o.A,{className:"h-4 w-4"})}),(0,r.jsx)("div",{className:"relative flex-1 overflow-hidden",children:(0,r.jsx)("div",{ref:f,className:"scrollbar-hide overflow-x-auto overflow-y-visible",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:(0,r.jsx)("div",{className:"inline-flex gap-1 py-0.5 pr-1",style:{minWidth:"max-content"},children:y.map((e,i)=>(0,r.jsx)("div",{className:"flex flex-col gap-0.75",children:e.map((e,a)=>{var n;return(0,r.jsx)("div",{className:`h-3 w-3 rounded-sm transition-colors ${-1===(n=e.value)?"bg-transparent":0===n?"bg-heatmap-empty":n<5?"bg-heatmap-level-1":n<10?"bg-heatmap-level-2":n<20?"bg-heatmap-level-3":"bg-heatmap-level-4"} ${-1===e.value?"cursor-default":c(e.date,s)?"ring-2 ring-amber-900":"cursor-pointer ring-1 ring-amber-300 hover:ring-2 hover:ring-amber-800"}`,onClick:()=>-1!==e.value&&t(e.date),onMouseEnter:t=>k(t,e),onMouseMove:t=>k(t,e),onMouseLeave:w},`${i}-${a}`)})},i))})})}),(0,r.jsx)(d.$,{onClick:()=>v("right"),className:"h-7 w-7 shrink-0 rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,r.jsx)(l.A,{className:"h-4 w-4"})})]}),p&&-1!==p.value&&(0,r.jsx)(u,{day:p,position:b})]})}var p=s(8169);function g({src:e,alt:t="Mascot"}){let[s,i]=(0,n.useState)(!1),[a,o]=(0,n.useState)(!1),[l,d]=(0,n.useState)(!1),[c,h]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=setInterval(()=>{h(!0),setTimeout(()=>h(!1),3e3)},5e3);return()=>clearInterval(e)},[]),(0,r.jsxs)("div",{className:"group relative size-full",children:[(0,r.jsx)("button",{onMouseEnter:()=>{i(!0),a||o(!0)},onMouseLeave:()=>{i(!1),d(!1)},onMouseDown:()=>d(!0),onMouseUp:()=>d(!1),className:`relative size-full cursor-pointer transition-transform select-none ${s?"translate-y-1":""} ${l?"scale-125":""} ${c?"animate-grass-pet-bounce":""}`,children:(0,r.jsx)(p.default,{src:e,alt:t,fill:!0,className:"object-contain select-none",draggable:!1})}),(0,r.jsx)("div",{className:`pointer-events-none absolute top-0 left-1/2 transition-opacity duration-500 ${s?"opacity-80":"opacity-0"} ${a?"animate-grass-heart-float":""}`,children:(0,r.jsx)("div",{className:`transition-transform select-none ${l?"scale-125":""}`,children:(0,r.jsx)(p.default,{src:"/assets/heart.png",alt:"Heart",width:24,height:24,className:"object-contain select-none",draggable:!1})})})]})}function b(){return(0,r.jsxs)("div",{className:"relative size-60 shrink-0 overflow-visible rounded-none",children:[(0,r.jsx)(p.default,{src:"/assets/grass-base.png",alt:"Garden",fill:!0,className:"scale-115 object-fill",style:{imageRendering:"pixelated"},priority:!0}),(0,r.jsx)("div",{className:"relative grid h-full w-full grid-cols-3 grid-rows-3 p-2",children:Array.from({length:9}).map((e,t)=>(0,r.jsx)("div",{className:"relative flex items-center justify-center",children:0===t&&(0,r.jsx)(g,{src:"/assets/mascot/gopher_stage1.svg",alt:"Gopher"})},t))})]})}function x({title:e,value:t}){return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-none border-2 border-amber-800/20 bg-amber-50 p-1",children:[(0,r.jsx)("h3",{className:"mb-1 text-xs font-bold",children:e}),(0,r.jsx)("p",{className:"text-sm text-amber-700",children:t})]})}function f(e,t){let s=t.toISOString().split("T")[0];return e.filter(e=>e.createdDate===s)}function y(e){let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}var v=s(4563);function k({tasks:e,selectedDate:t}){var s;let i,a,n,o,l=(0,v.O)(e=>e.focusTime),d=c(t,new Date),h=(s=d?l:void 0,a=f(e,t),i=void 0!==s?s:a.reduce((e,t)=>e+(t.time||0),0),n=a.filter(e=>e.completed).length,o=Math.min(a.length,20),{focusTime:y(i),completedTasks:String(n),push:String(Math.floor(.3*o)),issue:String(Math.floor(.15*o)),prCreated:String(Math.floor(.1*o)),prReview:String(Math.floor(.2*o))});return(0,r.jsxs)("div",{className:"flex h-60 gap-4",children:[(0,r.jsx)(b,{}),(0,r.jsxs)("div",{className:"grid h-full flex-1 grid-cols-3 grid-rows-2 gap-2",children:[(0,r.jsx)(x,{title:"집중시간",value:h.focusTime}),(0,r.jsx)(x,{title:"TASK",value:h.completedTasks}),(0,r.jsx)(x,{title:"PUSH",value:h.push}),(0,r.jsx)(x,{title:"ISSUE",value:h.issue}),(0,r.jsx)(x,{title:"PR 생성",value:h.prCreated}),(0,r.jsx)(x,{title:"PR 리뷰",value:h.prReview})]})]})}function w({tasks:e,selectedDate:t}){let s,i,a,n,o=f(e,t);return(0,r.jsxs)("div",{className:"rounded-none border-2 border-amber-800/20 bg-amber-50 p-3",children:[(0,r.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm font-bold",children:"Task 목록"}),(0,r.jsx)("p",{className:"text-xs text-amber-700",children:(s=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),n=["일","월","화","수","목","금","토"][t.getDay()],`${s}년 ${i}월 ${String(a).padStart(2,"0")}일 ${n}`)})]}),(0,r.jsx)("div",{className:"space-y-2",children:0===o.length?(0,r.jsx)("div",{className:"py-4 text-center text-xs text-amber-700",children:"이 날짜에 등록된 Task가 없습니다."}):o.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between rounded-none border border-amber-200 bg-amber-100/50 p-2 transition-colors hover:border-amber-400",children:[(0,r.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,r.jsx)("div",{className:`h-3 w-3 rounded-none border-2 ${e.completed?"border-amber-700 bg-amber-600":"border-amber-400 bg-transparent"}`}),(0,r.jsx)("span",{className:`text-xs ${e.completed?"text-amber-600 line-through":"text-amber-900"}`,children:e.description})]}),(0,r.jsx)("span",{className:"text-xs text-amber-700",children:y(e.time)})]},e.id))})]})}let j=["API 엔드포인트 작성","컴포넌트 리팩토링","버그 수정","유닛 테스트 작성","문서 작성","코드 리뷰","디자인 개선","성능 최적화","데이터베이스 스키마 설계","CI/CD 파이프라인 구축","보안 취약점 분석","기능 개발","UI/UX 개선","타입 정의 추가","에러 핸들링 구현","로깅 시스템 구축","캐싱 전략 적용","알고리즘 최적화","프로토타입 제작","회의 및 기획"],N=function(e=365){let t=[],{startDate:s,endDate:r}=h(e);for(let e=new Date(s);e<=r;e.setDate(e.getDate()+1)){let s=Math.floor(26*Math.random());t.push({date:e.toISOString().split("T")[0],taskCount:s})}return t}(365),S=function(e=365){let t=[],{startDate:s,endDate:r}=h(e),i=1;for(let e=new Date(s);e<=r;e.setDate(e.getDate()+1)){let s=Math.floor(26*Math.random());for(let r=0;r<s;r++){let s=Math.random()>.3,r=s?Math.floor(7200*Math.random())+300:Math.floor(1800*Math.random());t.push({id:i++,description:j[Math.floor(Math.random()*j.length)],completed:s,time:r,createdDate:e.toISOString().split("T")[0]})}}return t}(365);function T(){let e,[t,s]=(0,n.useState)(new Date),i=(e=t.toISOString().split("T")[0],S.filter(t=>t.createdDate===e));return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(m,{dailyTaskCounts:N,selectedDate:t,onSelectDate:s}),(0,r.jsxs)("div",{className:"space-y-4 text-amber-900",children:[(0,r.jsx)(k,{tasks:i,selectedDate:t}),(0,r.jsx)(w,{tasks:i,selectedDate:t})]})]})}function C(){return(0,r.jsx)("div",{className:"space-y-2 text-amber-900",children:(0,r.jsx)("h3",{className:"mb-2 border-b-2 border-amber-800/20 pb-1 font-bold",children:"최근 활동"})})}let M=[{id:"pet-basic-1",species:"go",stage:1,name:"고퍼",description:"구글에서 온 귀여운 두더지입니다. 단순하고 명료한 코드를 좋아합니다.",image:"/assets/pets/pet_go_1.png",maxExp:30},{id:"pet-basic-2",species:"go",stage:2,name:"고루틴",description:"매우 가볍고 빠릅니다. 수천 마리가 동시에 뛰어놀아도 지치지 않습니다.",image:"/assets/pets/pet_go_2.png",maxExp:100},{id:"pet-basic-3",species:"go",stage:3,name:"고헌터",description:"메모리 관리에 통달했습니다. 사용하지 않는 자원을 포착해 정리합니다.",image:"/assets/pets/pet_go_3.png",maxExp:0},{id:"pet-dev-1",species:"docker",stage:1,name:"도커",description:"넓은 바다를 꿈꾸는 아기 고래입니다. 컨테이너를 등에 지고 다닙니다.",image:"/assets/pets/pet_docker_1.png",maxExp:30},{id:"pet-dev-2",species:"docker",stage:2,name:"컴포즈",description:"친구들과 함께 다니는 것을 좋아합니다. 조화로운 서비스를 구성합니다.",image:"/assets/pets/pet_docker_2.png",maxExp:100},{id:"pet-dev-3",species:"docker",stage:3,name:"쿠버네티스",description:"거대한 클러스터의 선장입니다. 어떤 트래픽 파도가 쳐도 끄떡없습니다.",image:"/assets/pets/pet_docker_3.png",maxExp:0},{id:"pet-health-1",species:"java",stage:1,name:"자바콩",description:"따뜻한 커피 향이 나는 콩입니다. 어디서든 잘 자랍니다.",image:"/assets/pets/pet_java_1.png",maxExp:30},{id:"pet-health-2",species:"java",stage:2,name:"스프링",description:"강력한 프레임워크를 입었습니다. 객체 주입을 받는 것을 좋아합니다.",image:"/assets/pets/pet_java_2.png",maxExp:100},{id:"pet-health-3",species:"java",stage:3,name:"JVM",description:"가상 머신의 제왕입니다. 메모리 영역을 통제하며 군림합니다.",image:"/assets/pets/pet_java_3.png",maxExp:0}],E="bg-amber-600 px-4 py-2 hover:bg-amber-500 text-white border-b-4 border-r-4 border-amber-800 active:border-b-0 active:border-r-0 active:translate-y-1 active:translate-x-1 disabled:opacity-50 disabled:cursor-not-allowed";function I({onPetCollected:e}){let[t,s]=(0,n.useState)("idle"),[i,o]=(0,n.useState)(null),l=a(e=>e.points),d=a(e=>e.subtractPoints),c=(0,n.useMemo)(()=>M.filter(e=>1===e.stage),[]);return(0,r.jsxs)("div",{className:"flex flex-col gap-4 bg-amber-50 p-6 border-4 border-amber-900",children:[(0,r.jsx)("div",{className:"flex items-center justify-between border-b-2 border-amber-900/20 pb-2",children:(0,r.jsx)("h3",{className:"text-xl font-bold text-amber-900",children:"펫 뽑기"})}),(0,r.jsxs)("div",{className:"flex h-60 flex-col items-center justify-center gap-4",children:["idle"===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"gacha-egg"}),(0,r.jsxs)("p",{className:"text-center text-sm text-amber-700",children:["어떤 펫이 나올까요?",(0,r.jsx)("br",{}),"(1회: 100 P)"]}),(0,r.jsx)("button",{onClick:()=>{d(100)&&(s("animating"),setTimeout(()=>{let t=Math.floor(Math.random()*c.length),r=c[t];o(r),s("result"),e(r.id)},5e3))},disabled:l<100,className:E,children:"펫 뽑기"})]}),"animating"===t&&(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:"gacha-egg animating"}),(0,r.jsx)("p",{className:"animate-pulse text-lg font-bold text-amber-800",children:"알이 깨지고 있어요!"})]}),"result"===t&&i&&(0,r.jsxs)("div",{className:"animate-pop flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:"relative h-24 w-24",children:(0,r.jsx)(p.default,{src:i.image,alt:i.name,fill:!0,className:"object-contain",style:{imageRendering:"pixelated"}})}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-lg font-bold text-amber-900",children:"축하합니다!"}),(0,r.jsxs)("p",{className:"text-sm text-amber-700",children:[(0,r.jsx)("span",{className:"font-bold text-amber-900",children:i.name}),"을(를) 만났습니다!"]})]}),(0,r.jsx)("button",{onClick:()=>{s("idle"),o(null)},className:E,children:"확인"})]})]})]})}function _({stage:e,exp:t,maxExp:s,currentStageData:i,onAction:o}){let[l,d]=(0,n.useState)([]),c=a(e=>e.points),h=0===s,u=!h&&t>=s;return(0,r.jsxs)("div",{className:"flex gap-6 bg-amber-50 p-4 border-4 border-amber-900",children:[(0,r.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,r.jsxs)("div",{className:"relative h-32 w-32 drop-shadow-xl",children:[l.map(e=>(0,r.jsx)("div",{className:"flying-heart absolute size-10",style:{"--random-x":`${e.x}px`,left:"50%",top:"0"},children:(0,r.jsx)(p.default,{src:"/assets/heart.png",alt:"Heart",fill:!0,className:"object-contain",style:{imageRendering:"pixelated"}})},e.id)),(0,r.jsx)(p.default,{src:i.image,alt:i.name,fill:!0,className:"object-contain",style:{imageRendering:"pixelated"}})]})}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col justify-between text-sm font-bold",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("h2",{className:"text-2xl font-bold tracking-widest",children:i.name})}),(0,r.jsx)("p",{className:"text-sm text-amber-700",children:u?"✨ 진화가 가능합니다!":i.description}),(0,r.jsxs)("div",{className:"flex w-full items-end gap-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"mb-1 flex justify-between text-lg",children:[(0,r.jsx)("span",{children:"EXP"}),(0,r.jsx)("span",{children:h?"MAX":`${t} / ${s}`})]}),(0,r.jsxs)("div",{className:"relative h-6 w-full border-2 border-amber-900 bg-amber-900/10",children:[(0,r.jsx)("div",{className:`h-full transition-all duration-300 ease-out ${u?"animate-pulse bg-amber-500":"bg-green-500"}`,style:{width:h?"100%":`${t/s*100}%`}}),(0,r.jsx)("div",{className:"absolute inset-0 flex",children:[...Array(9)].map((e,t)=>(0,r.jsx)("div",{className:"flex-1 border-r border-amber-900/20"},t))})]})]}),(0,r.jsx)("div",{className:"relative flex w-1/5 justify-center",children:(0,r.jsx)("button",{onClick:()=>{if(o(),!u&&!h){let e=Date.now(),t=40*Math.random()-20;d(s=>[...s,{id:e,x:t}]),setTimeout(()=>{d(t=>t.filter(t=>t.id!==e))},800)}},disabled:h||!u&&c<10,className:`flex h-12 w-full flex-col items-center justify-center rounded text-base leading-tight font-bold transition-all ${h||!u&&c<10?"cursor-not-allowed border-r-4 border-b-4 border-gray-600 bg-gray-400 text-white opacity-70":u?"border-r-4 border-b-4 border-amber-800 bg-amber-600 text-white hover:bg-amber-500 active:translate-x-1 active:translate-y-1 active:border-r-0 active:border-b-0":"bg-green-600 px-2 hover:bg-green-500 text-white border-b-4 border-r-4 border-green-800 active:border-b-0 active:border-r-0 active:translate-y-1 active:translate-x-1"}`,children:(0,r.jsx)("span",{children:u?"✨ 진화":"밥주기 (10 P)"})})})]})]})]})}function D({collectedPetIds:e,activePetId:t,onPetSelect:s}){let i=M.reduce((e,t)=>(e[t.species]||(e[t.species]=[]),e[t.species].push(t),e),{});return(0,r.jsxs)("div",{className:"flex flex-col gap-4 bg-amber-50 p-6 border-4 border-amber-900",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between border-b-2 border-amber-900/20 pb-2",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-amber-900",children:"펫 도감"}),(0,r.jsxs)("span",{className:"text-xs font-bold text-amber-700",children:[e.length," / ",M.length," 수집"]})]}),(0,r.jsx)("div",{className:"flex h-auto flex-col gap-3",children:Object.entries(i).map(([i,a])=>(0,r.jsx)("div",{className:"flex flex-col gap-2 bg-amber-100/50 p-3 shadow-sm",children:(0,r.jsx)("div",{className:"grid w-full grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2",children:a.map((i,n)=>{let o=e.includes(i.id),l=i.id===t,d=n===a.length-1;return(0,r.jsxs)("div",{className:"contents",children:[(0,r.jsxs)("div",{onClick:()=>o&&s(i.id),className:`relative flex flex-col items-center justify-center bg-amber-100 p-2 aspect-auto hover:bg-amber-200 transition-colors border-2 border-amber-900/50 w-full ${o?"cursor-pointer":"bg-gray-200"}`,title:o?i.description:"???",children:[l&&(0,r.jsx)("div",{className:"absolute -top-2 -right-2 z-10 rotate-12 rounded border border-red-800 bg-red-500 px-1.5 py-0.5 text-[12px] font-bold text-white shadow-sm",children:"대표펫"}),(0,r.jsx)("div",{className:"relative mb-2 h-14 w-14",children:(0,r.jsx)(p.default,{src:i.image,alt:i.name,fill:!0,className:`object-contain ${o?"":"pointer-events-none opacity-40 brightness-0 grayscale"}`})}),(0,r.jsx)("p",{className:`w-full text-center text-xs font-bold ${o?"text-amber-900":"text-gray-500"}`,children:o?i.name:"???"})]}),!d&&(0,r.jsx)("div",{className:"flex justify-center text-amber-900/40",children:"▶"})]},i.id)})})},i))})]})}function F(){let e,[t,s]=(0,n.useState)("pet-basic-1"),[i,o]=(0,n.useState)(1),[l,d]=(0,n.useState)(0),[c,h]=(0,n.useState)(["pet-basic-1"]),u=a(e=>e.subtractPoints),m=(e=M.find(e=>e.id===t))?M.filter(t=>t.species===e.species):[],p=m.find(e=>e.stage===i)||m[0],g=p.maxExp,b=0===g,x=!b&&l>=g,f=e=>{c.includes(e)||h(t=>[...t,e])};return(0,r.jsxs)("div",{className:"flex h-auto flex-col gap-4 text-amber-900",children:[(0,r.jsx)(_,{stage:i,exp:l,maxExp:g,currentStageData:p,onAction:()=>{if(x){let e=i+1;o(e=>Math.min(e+1,m.length)),d(0);let t=m.find(t=>t.stage===e);t&&(f(t.id),s(t.id))}else{if(b)return;if(!u(10))return void alert("포인트가 부족합니다! (필요: 10 P)");d(e=>Math.min(e+10,g))}}}),(0,r.jsx)(I,{onPetCollected:f}),(0,r.jsx)(D,{collectedPetIds:c,activePetId:t,onPetSelect:e=>{let t=M.find(t=>t.id===e);t&&(s(e),o(t.stage),d(0))}})]})}let R="border-3 border-amber-900";function P(){let{isOpen:e,targetUsername:t,closeModal:s}=(0,i.U)(),[o,l]=(0,n.useState)("profile"),d=a(e=>e.points),c=(0,n.useCallback)(()=>{s(),l("profile")},[s]);return((0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&c()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c]),e)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-10",children:(0,r.jsxs)("div",{className:`relative w-full max-w-4xl bg-[#ffecb3] ${R} p-3 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.5)]`,children:[(0,r.jsxs)("div",{className:"mb-4 flex items-start justify-between",children:[(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("h2",{className:"text-xl font-extrabold tracking-wider text-amber-900",children:t})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 rounded border-2 border-amber-900/20 bg-amber-100 px-3 py-1 font-bold text-amber-800",children:(0,r.jsxs)("span",{children:[d.toLocaleString()," P"]})}),(0,r.jsx)("button",{onClick:c,className:`flex h-8 w-8 cursor-pointer items-center justify-center ${R} bg-red-400 leading-none font-bold text-white shadow-[2px_2px_0px_0px_rgba(30,30,30,0.3)] hover:bg-red-500 active:translate-x-[2px] active:translate-y-[2px] active:shadow-none`,children:"X"})]})]}),(0,r.jsxs)("div",{className:"mb-0 flex gap-1",children:[(0,r.jsx)($,{label:"프로필",isActive:"profile"===o,onClick:()=>l("profile")}),(0,r.jsx)($,{label:"활동",isActive:"activity"===o,onClick:()=>l("activity")}),(0,r.jsx)($,{label:"펫",isActive:"pet"===o,onClick:()=>l("pet")})]}),(0,r.jsxs)("div",{className:`my-2 bg-white/50 p-4 ${R} retro-scrollbar h-[500px] overflow-y-auto`,children:["profile"===o&&(0,r.jsx)(T,{}),"activity"===o&&(0,r.jsx)(C,{}),"pet"===o&&(0,r.jsx)(F,{})]})]})}):null}function $({label:e,isActive:t,onClick:s}){return(0,r.jsx)("button",{onClick:s,className:`flex-1 cursor-pointer py-2 text-sm font-bold transition-all ${R} ${t?"bg-amber-600 text-white":"bg-amber-200 text-amber-900 hover:bg-amber-300"} ${t&&"hover:brightness-110"}`,children:e})}},8450:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var r=s(546),i=s(2922),a=s(842),n=s(9873);function o({children:e}){let t=(0,i.useRouter)(),{isAuthenticated:s,isLoading:o,fetchUser:l}=(0,n.n)();return((0,a.useEffect)(()=>{l()},[l]),(0,a.useEffect)(()=>{o||s||t.replace("/login")},[o,s,t]),o)?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-900",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-gray-600 border-t-white"}),(0,r.jsx)("p",{className:"text-white",children:"로딩 중..."})]})}):s?(0,r.jsx)(r.Fragment,{children:e}):null}},8986:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>a,c:()=>o,cH:()=>n});var r=s(5893);let i=null,a=()=>(i||(i=(0,r.io)("http://138.2.116.232:8080",{transports:["websocket"],withCredentials:!0,autoConnect:!1})),i),n=()=>{let e=a();return e.connected||e.connect(),e},o=(e,t)=>{let s=a();s.connected&&s.emit(e,t)}},9873:(e,t,s)=>{"use strict";s.d(t,{n:()=>n});var r=s(7122),i=s(4902);let a="http://138.2.116.232:8080",n=(0,r.v)(e=>({user:null,isLoading:!0,isAuthenticated:!1,fetchUser:async()=>{try{e({isLoading:!0});let t=await fetch(`${a}/auth/me`,{credentials:"include"});if(t.ok){let s=await t.json();e({user:s,isAuthenticated:!0,isLoading:!1})}else e({user:null,isAuthenticated:!1,isLoading:!1})}catch(t){i.K.error("Failed to fetch user",{error:t}),e({user:null,isAuthenticated:!1,isLoading:!1})}},logout:()=>{window.location.href=`${a}/auth/logout`}}))}},e=>{e.O(0,[536,557,580,758,358],()=>e(e.s=7351)),_N_E=e.O()}]);