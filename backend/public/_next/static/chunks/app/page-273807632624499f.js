(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{94:(e,t,s)=>{"use strict";s.d(t,{default:()=>T});var a=s(546),r=s(842),i=s(6346),n=s(4816),o=s(8143),l=s(8986),c=s(807),d=s(7335);let h="stop";class u{constructor(e,t){this.sprite=null,this.currentDirection=h,this.offset={x:35,y:0},this.PET_SIZE=50,this.DISTANCE_X=40,this.DISTANCE_Y=50,this.BODY_CENTER_Y=5,this.scene=e,this.container=t}setTexture(e){this.scene.textures.exists(e)&&(this.sprite?(this.sprite.setTexture(e),this.setSpriteScale()):(this.sprite=this.scene.add.image(this.offset.x,this.offset.y,e),this.setSpriteScale(),this.sprite.setOrigin(.5,.5),this.container.add(this.sprite),this.container.sendToBack(this.sprite)))}setSpriteScale(){if(!this.sprite)return;let e=this.sprite.width,t=this.sprite.height,s=this.PET_SIZE/Math.max(e,t);this.sprite.setScale(s)}getSprite(){return this.sprite}updatePosition(e){if(!this.sprite||e===this.currentDirection)return;this.currentDirection=e;let t=0,s=this.BODY_CENTER_Y+this.DISTANCE_Y;switch(e){case"left":t=this.DISTANCE_X,s=this.BODY_CENTER_Y;break;case"right":t=-this.DISTANCE_X,s=this.BODY_CENTER_Y;break;case"up":t=0,s=this.BODY_CENTER_Y+this.DISTANCE_Y;break;case"down":t=0,s=this.BODY_CENTER_Y-this.DISTANCE_Y;break;case"left-up":t=this.DISTANCE_X,s=this.BODY_CENTER_Y+this.DISTANCE_X;break;case"left-down":t=this.DISTANCE_X,s=this.BODY_CENTER_Y-this.DISTANCE_X;break;case"right-up":t=-this.DISTANCE_X,s=this.BODY_CENTER_Y+this.DISTANCE_X;break;case"right-down":t=-this.DISTANCE_X,s=this.BODY_CENTER_Y-this.DISTANCE_X;break;default:return}this.scene.tweens.add({targets:this.sprite,x:t,y:s,duration:150,ease:"Power2"}),this.offset={x:t,y:s}}destroy(){this.sprite&&(this.sprite.destroy(),this.sprite=null)}}class m{constructor(e,t,s,a,r,n="face",o=0){this.bodyGlow=null,this.taskBubbleContainer=null,this.playerId=0,this.speed=300,this.scene=e,this.id=r,this.username=a,this.playerId=o,this.container=e.add.container(t,s),this.bodySprite=e.add.sprite(0,5,"body"),this.bodySprite.setFrame(0),this.maskShape=e.make.graphics({}),this.maskShape.fillStyle(0xffffff),this.maskShape.fillCircle(0,0,17),this.maskShape.x=t,this.maskShape.y=s;const l=this.maskShape.createGeometryMask(),h=e.textures.exists(n)?n:"face";this.faceSprite=e.add.image(0,0,h),this.faceSprite.setDisplaySize(34,34),this.faceSprite.setMask(l),this.borderGraphics=e.add.graphics(),this.borderGraphics.lineStyle(2,0xffffff,1),this.borderGraphics.strokeCircle(0,0,17);const m=e.add.text(0,50,a,{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"15px",color:"#ffffff",backgroundColor:"#00000088",padding:{x:4,y:2}}).setOrigin(.5).setResolution(2);this.focusTimeText=e.add.text(0,66,(0,c.F)(0),{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"13px",color:"#ffffff",backgroundColor:"#00000088",padding:{x:4,y:.5}}).setOrigin(.5).setResolution(2),this.pet=new u(e,this.container);const p=[this.bodySprite,this.faceSprite,this.borderGraphics,m,this.focusTimeText];this.container.add(p),this.container.setSize(34,51),e.physics.world.enable(this.container),this.body=this.container.body,this.body.setCollideWorldBounds(!0),this.body.setSize(34,8.5),this.body.setOffset(0,50),this.container.setInteractive(new i.Geom.Rectangle(0,10,34,51),i.Geom.Rectangle.Contains),this.bodySprite.preFX&&(this.bodyGlow=this.bodySprite.preFX.addGlow(0xffff00,4,0,!1),this.bodyGlow.active=!1),this.container.on("pointerdown",(e,t,s,a)=>{let r,i,n=e.event;(n instanceof TouchEvent?(r=n.touches[0]?.clientX??0,i=n.touches[0]?.clientY??0):(r=n.clientX,i=n.clientY),document.elementFromPoint(r,i)!==this.scene.game.canvas)?a.stopPropagation():d.K.getState().openModal(d.e.USER_INFO,{playerId:this.playerId,username:this.username})}),this.container.on("pointerover",()=>{this.scene.game.canvas.style.cursor="pointer",this.borderGraphics.clear(),this.borderGraphics.lineStyle(3,0xffff00,1),this.borderGraphics.strokeCircle(0,0,17),this.bodyGlow&&(this.bodyGlow.active=!0)}),this.container.on("pointerout",()=>{this.scene.game.canvas.style.cursor="default",this.borderGraphics.clear(),this.borderGraphics.lineStyle(2,0xffffff,1),this.borderGraphics.strokeCircle(0,0,17),this.bodyGlow&&(this.bodyGlow.active=!1)})}update(){this.container&&this.maskShape&&(this.maskShape.x=this.container.x,this.maskShape.y=this.container.y)}updatePetPosition(e){this.pet.updatePosition(e)}updateFocusTime(e){this.focusTimeText&&this.focusTimeText.setText((0,c.F)(e))}getPosition(){return{x:this.container.x,y:this.container.y}}getContainer(){return this.container}setPosition(e,t){this.container.setPosition(e,t),this.body&&this.body.reset(e,t)}destroy(){this.pet.destroy(),this.container.destroy(),this.maskShape.destroy()}updateFaceTexture(e){this.faceSprite&&this.scene.textures.exists(e)&&(this.faceSprite.setTexture(e),this.faceSprite.setDisplaySize(34,34))}playAnimation(e,t=!0){this.bodySprite&&this.bodySprite.play(e,t)}stopAnimation(){this.bodySprite&&this.bodySprite.stop()}setPet(e){if(!e)return void this.pet.destroy();let t=e.split("/").pop();if(!t)return void console.warn("[BasePlayer] Invalid imageUrl format:",e);let s=`pet_${t}`;if(this.scene.textures.exists(s))return void this.pet.setTexture(s);this.scene.load.image(s,e);let a=e=>{e.key===s&&(console.error(`[BasePlayer] Load error for ${s}:`,e),this.scene.load.off("loaderror",a))};this.scene.load.on("loaderror",a),this.scene.load.once(`filecomplete-image-${s}`,()=>{this.pet.setTexture(s),this.scene.load.off("loaderror",a)}),this.scene.load.start()}updateTaskBubble(e){this.taskBubbleContainer&&(this.taskBubbleContainer.destroy(),this.taskBubbleContainer=null);let{isFocusing:t,taskName:s}=e;this.taskBubbleContainer=this.scene.add.container(0,-40),this.taskBubbleContainer.setName("taskBubble");let a=[],r=this.scene.add.graphics();r.fillStyle(t?2278750:0xef4444,1);let i=this.scene.add.text(0,0,t?"작업 중":"휴식 중",{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"13px",color:t?"#166534":"#991b1b"});i.setResolution(2),i.setOrigin(0,.5),a.push(r,i);let n=null;if(t&&s){let e=s.length>15?s.slice(0,15)+"...":s;(n=this.scene.add.text(0,0,e,{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"12px",color:"#374151"})).setResolution(2),n.setOrigin(.5,.5),a.push(n)}let o=Math.max(11+i.width,n?n.width+24:0)+16,l=n?38:24,c=this.scene.add.graphics();if(c.fillStyle(t?0xdcfce7:0xfee2e2,1),c.lineStyle(1,t?8843180:0xfca5a5,1),c.fillRoundedRect(-o/2,-l/2,o,l,l/2),c.strokeRoundedRect(-o/2,-l/2,o,l,l/2),n){let e=-o/2+8+5+6;r.fillCircle(-o/2+8+2.5,-6,2.5),i.setPosition(e,-6),n.setOrigin(0,.5),n.setPosition(e,8)}else r.fillCircle(-o/2+8+2.5,0,2.5),i.setPosition(-o/2+8+5+6,0);this.taskBubbleContainer.add([c,...a]),this.container.add(this.taskBubbleContainer),this.container.bringToTop(this.taskBubbleContainer)}showChatBubble(e){let t=this.container.getByName("chatBubble");t&&t.destroy();let s=40*!!this.taskBubbleContainer,a=this.scene.add.container(0,-40-s);a.setName("chatBubble");let r=this.scene.add.text(0,0,e,{fontFamily:"NeoDunggeunmo, Arial, sans-serif",fontSize:"14px",color:"#000000",wordWrap:{width:150,useAdvancedWrap:!0}});r.setResolution(2),r.setOrigin(.5);let i=r.getBounds(),n=i.width+24,o=i.height+12,l=this.scene.add.graphics();l.fillStyle(0,.02),l.fillRoundedRect(-n/2+5,-o/2+5,n,o,10),l.fillStyle(0,.04),l.fillRoundedRect(-n/2+3,-o/2+4,n,o,10),l.fillStyle(0,.08),l.fillRoundedRect(-n/2+1,-o/2+2,n,o,10),l.fillStyle(0xffffff,1),l.lineStyle(1,0xd1d5db,1),l.fillRoundedRect(-n/2,-o/2,n,o,10),l.strokeRoundedRect(-n/2,-o/2,n,o,10),l.fillStyle(0xffffff,1),l.fillTriangle(-4,o/2-1,4,o/2-1,0,o/2+6),l.lineStyle(1.5,0xe5e7eb,1),l.lineBetween(-4,o/2,0,o/2+6),l.lineBetween(4,o/2,0,o/2+6),a.add([l,r]),this.container.add(a),this.scene.time.delayedCall(5e3,()=>{a.active&&a.destroy()}),this.container.bringToTop(a),this.taskBubbleContainer&&this.container.bringToTop(this.taskBubbleContainer)}}class p extends m{constructor(e,t,s,a,r,i,n=0){super(e,t,s,a,r,a,n),this.prevState={isMoving:!1,direction:h},this.roomId=i}setRoomId(e){this.roomId=e}update(e){if(super.update(),!this.body||!e)return;let t=0,s=0,a="",r="";e.left.isDown?(t=-this.speed,a="left"):e.right.isDown&&(t=this.speed,a="right"),e.up.isDown?(s=-this.speed,r="up"):e.down.isDown&&(s=this.speed,r="down"),this.body.setVelocity(t,s);let i=0!==t||0!==s;if(i){let e=this.body.blocked;"left"===a&&e.left&&(i=!1),"right"===a&&e.right&&(i=!1),"up"===r&&e.up&&(i=!1),"down"===r&&e.down&&(i=!1)}let n=h;if(i&&(a&&r?n=`${a}-${r}`:a?n=a:r&&(n=r)),i?"left"===a?this.playAnimation("walk-left"):"right"===a?this.playAnimation("walk-right"):"up"===r?this.playAnimation("walk-up"):"down"===r&&this.playAnimation("walk-down"):this.stopAnimation(),i!==this.prevState.isMoving||n!==this.prevState.direction){let e={roomId:this.roomId,userId:this.id,x:this.container.x,y:this.container.y,isMoving:i,direction:n,timestamp:Date.now()};(0,l.c)("moving",e),this.updatePetPosition(n),this.prevState={isMoving:i,direction:n}}}}var b=s(4563),x=s(3087);class g{constructor(e,t){this.currentMapIndex=0,this.tileSize=32,this.worldScale=2,this.scene=e,this.maps=t}setup(){let e=this.maps[this.currentMapIndex],t=this.scene.add.image(0,0,e.image);t.setOrigin(0,0),t.setName("mapImage"),t.setDepth(-1);let s=t.width/this.worldScale,a=t.height/this.worldScale;if(t.setScale(1/this.worldScale),this.scene.physics.world.setBounds(0,0,s,a),this.walls=this.scene.physics.add.staticGroup(),e.tilemap){let t=this.scene.make.tilemap({key:e.tilemap}).getObjectLayer("Collisions");t&&t.objects.forEach(e=>{if(("class"in e&&"wall"===e.class||"wall"===e.type)&&void 0!==e.x&&void 0!==e.y){let t=this.scene.add.rectangle((e.x+(e.width||0)/2)/this.worldScale,(e.y+(e.height||0)/2)/this.worldScale,(e.width||0)/this.worldScale,(e.height||0)/this.worldScale,0xff0000,0);t.setVisible(!1),this.walls?.add(t)}})}}getMapImage(){return this.scene.children.getByName("mapImage")}getWalls(){return this.walls}getMapSize(){let e=this.getMapImage();return e?{width:e.width/this.worldScale,height:e.height/this.worldScale}:{width:0,height:0}}getWorldScale(){return this.worldScale}getTileSize(){return this.tileSize}switchToNextMap(e){this.currentMapIndex=(this.currentMapIndex+1)%this.maps.length,this.scene.cameras.main.fadeOut(500,0,0,0),this.scene.cameras.main.once("camerafadeoutcomplete",()=>{let t=this.scene.children.getByName("mapImage");t&&t.destroy(),this.walls?.clear(!0,!0),this.setup(),e(),this.scene.cameras.main.fadeIn(500,0,0,0)})}getCurrentMapIndex(){return this.currentMapIndex}destroy(){this.walls?.clear(!0,!0);let e=this.getMapImage();e&&e.destroy()}getRandomSpawnPosition(){let{width:e,height:t}=this.getMapSize(),s=e/2,a=t/2,r=.2*e,i=.2*t,n=this.getWallRects();for(let e=0;e<10;e++){let e=s+(Math.random()-.5)*r,t=a+(Math.random()-.5)*i;if(!n.some(s=>this.rectIntersects(e-16,t-16,32,32,s.x,s.y,s.width,s.height)))return{x:Math.round(e),y:Math.round(t)}}return console.warn("Failed to find valid spawn position, using center"),{x:Math.round(s),y:Math.round(a)}}getWallRects(){let e=[];return this.walls&&this.walls.getChildren().forEach(t=>{e.push({x:t.x-t.width/2,y:t.y-t.height/2,width:t.width,height:t.height})}),e}rectIntersects(e,t,s,a,r,i,n,o){return e<r+n&&e+s>r&&t<i+o&&t+a>i}}var f=s(4902);class y extends m{constructor(e,t,s,a,r,i,n=0){super(e,t,s,a,r,i,n),this.isFocusing=!1,this.baseFocusSeconds=0,this.serverCurrentSessionSeconds=0,this.serverReceivedAt=0}setFocusState(e,t){this.isFocusing=e,this.baseFocusSeconds=t?.totalFocusSeconds??0,e?(this.serverCurrentSessionSeconds=t?.currentSessionSeconds??0,this.serverReceivedAt=Date.now()):(this.serverCurrentSessionSeconds=0,this.serverReceivedAt=0),this.updateFocusDisplay(),this.updateTaskBubble({isFocusing:e,taskName:t?.taskName})}getDisplayTime(){if(this.isFocusing&&this.serverReceivedAt>0){let e=Math.floor((Date.now()-this.serverReceivedAt)/1e3);return this.baseFocusSeconds+this.serverCurrentSessionSeconds+e}return this.baseFocusSeconds}updateFocusDisplay(){this.updateFocusTime(this.getDisplayTime())}getFocusState(){return this.isFocusing}destroy(){super.destroy()}updateState(e){this.body?(super.update(),i.Math.Distance.Between(this.container.x,this.container.y,e.x,e.y)>50&&this.container.setPosition(e.x,e.y),this.container.x=i.Math.Linear(this.container.x,e.x,.1),this.container.y=i.Math.Linear(this.container.y,e.y,.1),this.body.setVelocity(0),e.isMoving?(e.direction.includes("left")&&(this.body.setVelocityX(-this.speed),this.playAnimation("walk-left")),e.direction.includes("right")&&(this.body.setVelocityX(this.speed),this.playAnimation("walk-right")),e.direction.includes("up")&&(this.body.setVelocityY(-this.speed),this.playAnimation("walk-up")),e.direction.includes("down")&&(this.body.setVelocityY(this.speed),this.playAnimation("walk-down"))):(this.stopAnimation(),this.container.setPosition(e.x,e.y)),this.updatePetPosition(e.direction)):f.K.error("RemotePlayer body not found")}}class v{constructor(e,t,s){this.otherPlayers=new Map,this.roomId="",this.isSessionReplaced=!1,this.scene=e,this.username=t,this.getPlayer=s}setWalls(e){this.walls=e}setProgressBarController(e){this.progressBarController=e}setContributionController(e){this.contributionController=e}getRoomId(){return this.roomId}connect(e){let t=(0,l.cH)();if(!t)return;let s=this.getPlayer();t.on("connect",()=>{e.hideConnectionLostOverlay(),this.isSessionReplaced=!1,s&&t.id&&(s.id=t.id),t.emit("joining",{x:s?.getContainer().x,y:s?.getContainer().y,username:this.username})}),t.on("auth_expired",()=>{window.location.href="/login"}),t.on("disconnect",async t=>{if(!this.isSessionReplaced&&"io client disconnect"!==t){try{let e=await fetch("/auth/me",{credentials:"include"});if(401===e.status){window.location.href="/login";return}}catch{}e.showConnectionLostOverlay()}}),t.on("joined",e=>{this.roomId=e.roomId;let t=this.getPlayer();t&&t.setRoomId(e.roomId),e.focusTime&&b.O.getState().syncFromServer(e.focusTime)}),t.on("session_replaced",()=>{this.isSessionReplaced=!0,t.disconnect(),e.showSessionEndedOverlay()}),t.on("players_synced",e=>{e.forEach(e=>{this.addRemotePlayer(e)})}),t.on("player_joined",e=>{this.addRemotePlayer(e)}),t.on("moved",e=>{let t=this.otherPlayers.get(e.userId);t&&void 0!==e.isMoving&&void 0!==e.direction&&t.updateState({x:e.x,y:e.y,isMoving:e.isMoving,direction:e.direction})}),t.on("player_left",e=>{let t=this.otherPlayers.get(e.userId);t&&(t.destroy(),this.otherPlayers.delete(e.userId))}),t.on("github_state",e=>{this.progressBarController?.setProgress(e.progress),this.contributionController?.setContributions(e.contributions)}),t.on("github_event",e=>{let t=2*e.pushCount+5*e.pullRequestCount;if(t>0){this.progressBarController?.addProgress(t);let s=e.pushCount+e.pullRequestCount;this.contributionController?.addContribution(e.username,s)}}),t.on("chatted",e=>{let t=this.otherPlayers.get(e.userId);t&&t.showChatBubble(e.message)}),t.on("focused",e=>{if(e.status!==b.M.FOCUSING)return;let t=this.otherPlayers.get(e.userId);t&&t.setFocusState(!0,{taskName:e.taskName,totalFocusSeconds:e.totalFocusSeconds??0,currentSessionSeconds:e.currentSessionSeconds??0})}),t.on("rested",e=>{if(e.status!==b.M.RESTING)return;let t=this.otherPlayers.get(e.userId);t&&t.setFocusState(!1,{totalFocusSeconds:e.totalFocusSeconds??0})}),t.on("focus_task_updated",e=>{let t=this.otherPlayers.get(e.userId);t&&t.updateTaskBubble({isFocusing:!0,taskName:e.taskName})}),t.on("pet_equipped",e=>{let t=this.otherPlayers.get(e.userId);t&&t.setPet(e.petImage)})}addRemotePlayer(e){if(this.otherPlayers.has(e.userId))return;let t=this.getPlayer();if(t&&t.id===e.userId)return;let s=e.username||"unknown",a=new y(this.scene,e.x,e.y,s,e.userId,s,e.playerId??0);if(this.otherPlayers.set(e.userId,a),a.setFocusState(e.status===b.M.FOCUSING,{totalFocusSeconds:e.totalFocusSeconds??0,currentSessionSeconds:e.currentSessionSeconds??0,taskName:e.taskName??void 0}),e.petImage&&a.setPet(e.petImage),this.walls&&this.scene.physics.add.collider(a.getContainer(),this.walls),!this.scene.textures.exists(s)){let e=`https://avatars.githubusercontent.com/${s}`;this.scene.load.image(s,e),this.scene.load.once(`filecomplete-image-${s}`,()=>{a.updateFaceTexture(s)}),this.scene.load.start()}}setupCollisions(){this.otherPlayers.forEach(e=>{this.walls&&this.scene.physics.add.collider(e.getContainer(),this.walls)})}getRemotePlayers(){return this.otherPlayers}updateRemotePlayers(){this.otherPlayers.forEach(e=>{e.update(),e.updateFocusDisplay()})}sendChat(e){let t=this.getPlayer();if(!t)return;t.showChatBubble(e);let s=(0,l.Ol)();s&&s.emit("chatting",{message:e})}destroy(){this.otherPlayers.forEach(e=>e.destroy()),this.otherPlayers.clear()}}class w{constructor(e,t){this.input=null,this.scene=e,this.sendMessage=t}setup(){let e=document.getElementById("chat-input");e&&e.remove();let t=document.createElement("input");t.id="chat-input",t.type="text",t.className="absolute bottom-[100px] left-1/2 -translate-x-1/2 w-[320px] p-3 text-base border-4 border-gray-800 bg-white shadow-[4px_4px_0_0_rgba(0,0,0,0.5)] font-['NeoDunggeunmo',_Arial,_sans-serif] outline-none hidden z-[1000] placeholder:text-gray-400",t.placeholder="메시지를 입력하세요 (Enter로 전송)",document.body.appendChild(t),this.input=t,this.scene.input.keyboard?.on("keydown-ENTER",()=>{document.activeElement!==t&&(t.style.display="block",t.focus(),this.scene.input.keyboard.enabled=!1)}),t.addEventListener("keydown",e=>{e.stopPropagation(),"Enter"===e.key?(""!==t.value.trim()&&this.sendMessage(t.value),this.closeInput()):"Escape"===e.key&&this.closeInput()}),this.scene.events.on(i.Scenes.Events.SHUTDOWN,()=>{this.destroy()})}closeInput(){this.input&&(this.input.value="",this.input.style.display="none",this.input.blur(),setTimeout(()=>{this.scene&&this.scene.input&&this.scene.input.keyboard&&(this.scene.input.keyboard.enabled=!0)},100))}destroy(){this.input&&(this.input.remove(),this.input=null)}}class j{constructor(e){this.minZoom=.7,this.maxZoom=2,this.mapWidth=0,this.mapHeight=0,this.scene=e}setup(e,t,s){this.mapWidth=e,this.mapHeight=t,this.scene.cameras.main.setBounds(0,0,e,t),this.scene.cameras.main.centerOn(e/2,t/2),s&&this.scene.cameras.main.startFollow(s,!0,.05,.05),this.setInitialZoom(e,t),this.scene.input.on("wheel",this.handleZoom,this),this.scene.scale.on("resize",this.handleResize,this)}setInitialZoom(e,t){let s=this.scene.scale.width,a=this.scene.scale.height,r=Math.min(s/e,a/t);this.minZoom=r,this.scene.cameras.main.setZoom(r);let i=e*r,n=t*r,o=(s-i)/2/r,l=(a-n)/2/r;this.scene.cameras.main.setBounds(-o,-l,e+2*o,t+2*l),this.scene.cameras.main.centerOn(e/2,t/2)}handleResize(){this.mapWidth>0&&this.mapHeight>0&&this.setInitialZoom(this.mapWidth,this.mapHeight)}handleZoom(e,t,s,a){let r=this.scene.cameras.main.zoom,i=Math.max(this.minZoom,Math.min(this.maxZoom,r+(a>0?-.2:.2)));this.scene.cameras.main.setZoom(i)}updateBounds(e,t){this.mapWidth=e,this.mapHeight=t,this.scene.cameras.main.setBounds(0,0,e,t),this.setInitialZoom(e,t)}destroy(){this.scene.input.off("wheel",this.handleZoom,this),this.scene.scale.off("resize",this.handleResize,this)}}class k extends i.Scene{constructor(){super({key:"MogakcoScene"}),this.username="",this.playerId=0,this.maps=[{image:"tiles1",tilemap:"tilemap1",imagePath:"/assets/maps/dessert_stage1.webp",tilemapPath:"/assets/tilemaps/dessert_stage1.json"},{image:"tiles2",tilemap:"tilemap2",imagePath:"/assets/maps/dessert_stage2.webp",tilemapPath:"/assets/tilemaps/dessert_stage2.json"},{image:"tiles3",tilemap:"tilemap3",imagePath:"/assets/maps/dessert_stage3.webp",tilemapPath:"/assets/tilemaps/dessert_stage3.json"},{image:"tiles4",tilemap:"tilemap4",imagePath:"/assets/maps/dessert_stage4.webp",tilemapPath:"/assets/tilemaps/dessert_stage4.json"},{image:"tiles5",tilemap:"tilemap5",imagePath:"/assets/maps/dessert_stage5.webp",tilemapPath:"/assets/tilemaps/dessert_stage5.json"}],this.petImage=null,this.lastTaskBubbleState=null}preload(){this.load.crossOrigin="anonymous",this.maps.forEach(e=>{this.load.image(e.image,e.imagePath),e.tilemapPath&&this.load.tilemapTiledJSON(e.tilemap,e.tilemapPath)}),this.load.spritesheet("body","/assets/body.png",{frameWidth:64,frameHeight:64});let e=this.username||"boostcampwm2025";this.load.image("face",`https://avatars.githubusercontent.com/${e}`),this.load.svg("pet","/assets/mascot/gopher_stage1.svg",{width:512,height:512})}init(){let e=this.registry.get("user");this.username=e?.username,this.playerId=e?.playerId??0,this.petImage=e?.petImage}create(){this.mapManager=new g(this,this.maps),this.mapManager.setup();let e=e=>{this.player&&e.detail?.petImage&&this.player.setPet(e.detail.petImage)};window.addEventListener("local_pet_update",e),this.events.once("destroy",()=>{window.removeEventListener("local_pet_update",e)}),this.createAnimations(),this.setupPlayer(),this.setupCollisions(),this.setupControls(),this.setupUI(),this.cameraController=new j(this);let{width:t,height:s}=this.mapManager.getMapSize();this.cameraController.setup(t,s,this.player?.getContainer()),this.socketManager=new v(this,this.username,()=>this.player),this.socketManager.setWalls(this.mapManager.getWalls()),this.socketManager.setProgressBarController(this.progressBarController),this.socketManager.setContributionController(this.contributionController),this.socketManager.connect({showSessionEndedOverlay:()=>this.showSessionEndedOverlay(),showConnectionLostOverlay:()=>this.showConnectionLostOverlay(),hideConnectionLostOverlay:()=>this.hideConnectionLostOverlay()}),this.chatManager=new w(this,e=>this.socketManager.sendChat(e)),this.chatManager.setup(),this.events.on("shutdown",this.cleanup,this)}cleanup(){this.cameraController?.destroy(),this.events.off("shutdown",this.cleanup,this)}createAnimations(){this.anims.exists("walk-down")||this.anims.create({key:"walk-down",frames:this.anims.generateFrameNumbers("body",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.exists("walk-left")||this.anims.create({key:"walk-left",frames:this.anims.generateFrameNumbers("body",{start:4,end:7}),frameRate:10,repeat:-1}),this.anims.exists("walk-right")||this.anims.create({key:"walk-right",frames:this.anims.generateFrameNumbers("body",{start:8,end:11}),frameRate:10,repeat:-1}),this.anims.exists("walk-up")||this.anims.create({key:"walk-up",frames:this.anims.generateFrameNumbers("body",{start:12,end:15}),frameRate:10,repeat:-1})}setupPlayer(){let e=this.mapManager.getRandomSpawnPosition(),t=(0,l.Ol)(),s=t?.id||`guest-${Math.floor(1e3*Math.random())}`;this.player=new p(this,e.x,e.y,this.username,s,"pending",this.playerId),this.player.setRoomId("pending"),this.petImage&&this.player.setPet(this.petImage)}setupControls(){this.input.keyboard&&(this.cursors=this.input.keyboard.createCursorKeys(),this.xKey=this.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.X))}setupUI(){var e;let t,s,a,r,i,n,o,l,c,d,{width:h}=this.mapManager.getMapSize();this.progressBarController&&this.progressBarController.destroy(),this.contributionController&&this.contributionController.destroy(),this.progressBarController=(e=this,t={width:384,height:24,x:h/2-192,y:50,radius:12,border:1},s=0,(a=e.add.graphics()).fillStyle(0xe5e7eb,1),a.fillRoundedRect(t.x,t.y,t.width,t.height,t.radius),a.lineStyle(t.border,2042167,1),a.strokeRoundedRect(t.x,t.y,t.width,t.height,t.radius),a.setDepth(1e3),(r=e.add.graphics()).setDepth(1001),(i=()=>{r.clear();let e=t.border+2,a=(t.width-2*e)*s/100,i=t.radius-e,n=t.height-2*e;if(a>0)if(r.fillStyle(4906624,1),a>=2*i)r.fillRoundedRect(t.x+e,t.y+e,a,n,i);else{let s=Math.max(a,i);r.fillRoundedRect(t.x+e,t.y+e,s,n,{tl:i,tr:0,bl:i,br:0})}})(),n=(t,a)=>{e.tweens.add({targets:{value:s},value:t,duration:300,ease:"Cubic.easeOut",onUpdate:e=>{let t=e.getValue();"number"==typeof t&&(s=t,i())},onComplete:()=>{a?.()}})},o={addProgress:t=>{n(Math.min(s+t,100),()=>{s>=100&&(o.onProgressComplete?.(),e.time.delayedCall(1e3,()=>{n(0)}))})},setProgress:e=>{s=Math.max(0,Math.min(100,e)),i()},reset:()=>{n(0)},getProgress:()=>s,destroy:()=>{a.destroy(),r.destroy()}}),this.progressBarController.onProgressComplete=()=>{this.mapManager.switchToNextMap(()=>{this.setupCollisions(),this.setupUI();let{width:e,height:t}=this.mapManager.getMapSize();if(this.cameraController.updateBounds(e,t),this.socketManager.setWalls(this.mapManager.getWalls()),this.socketManager.setupCollisions(),this.socketManager.setProgressBarController(this.progressBarController),this.socketManager.setContributionController(this.contributionController),this.player){let e=this.mapManager.getRandomSpawnPosition();this.player.setPosition(e.x,e.y)}})},this.contributionController=(l=new Map,(c=this.add.text(h/2,85,"",{fontSize:"14px",color:"#374151",fontFamily:"monospace"})).setOrigin(.5,0),c.setDepth(1e3),d=()=>{let e=Array.from(l.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5);if(0===e.length)return void c.setText("");let t=e.map(([e,t])=>`${e}:${t}`).join("  ");c.setText(t)},{addContribution:(e,t)=>{let s=l.get(e)||0;l.set(e,s+t),d()},setContributions:e=>{for(let[t,s]of(l.clear(),Object.entries(e)))l.set(t,s);d()},reset:()=>{l.clear(),d()},destroy:()=>{c.destroy()}})}setupCollisions(){let e=this.mapManager.getWalls();e&&this.player&&this.physics.add.collider(this.player.getContainer(),e)}showSessionEndedOverlay(){this.scene.pause();let e=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.7);e.setScrollFactor(0),e.setDepth(1e3);let t=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"다른 탭에서 접속하여\n현재 세션이 종료되었습니다.",{fontSize:"24px",color:"#ffffff",align:"center"});t.setOrigin(.5),t.setScrollFactor(0),t.setDepth(1001)}showConnectionLostOverlay(){if(this.connectionLostOverlay)return;this.connectionLostOverlay=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.7),this.connectionLostOverlay.setScrollFactor(0),this.connectionLostOverlay.setDepth(1e3);let e=this.cameras.main.height,t=Math.round(.04*e),s=Math.round(.03*e);this.connectionLostText=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-.05*e,"서버와의 연결이 끊어졌습니다.",{fontSize:`${t}px`,color:"#ffffff",align:"center"}),this.connectionLostText.setOrigin(.5),this.connectionLostText.setScrollFactor(0),this.connectionLostText.setDepth(1001),this.connectionLostButton=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+.05*e,"새로고침",{fontSize:`${s}px`,color:"#4ade80",align:"center"}),this.connectionLostButton.setOrigin(.5),this.connectionLostButton.setScrollFactor(0),this.connectionLostButton.setDepth(1001),this.connectionLostButton.setInteractive({useHandCursor:!0}),this.connectionLostButton.on("pointerup",()=>window.location.reload());let a=this.connectionLostButton.getBounds();this.connectionLostButtonBorder=this.add.graphics(),this.connectionLostButtonBorder.lineStyle(2,4906624,1),this.connectionLostButtonBorder.strokeRoundedRect(a.x-16,a.y-8,a.width+32,a.height+16,8),this.connectionLostButtonBorder.setScrollFactor(0),this.connectionLostButtonBorder.setDepth(1001)}hideConnectionLostOverlay(){this.connectionLostOverlay&&(this.connectionLostOverlay.destroy(),this.connectionLostOverlay=void 0),this.connectionLostText&&(this.connectionLostText.destroy(),this.connectionLostText=void 0),this.connectionLostButton&&(this.connectionLostButton.destroy(),this.connectionLostButton=void 0),this.connectionLostButtonBorder&&(this.connectionLostButtonBorder.destroy(),this.connectionLostButtonBorder=void 0)}update(){if(!this.player||!this.cursors)return;if(this.xKey&&i.Input.Keyboard.JustDown(this.xKey)){let e=100-(this.progressBarController?.getProgress()||0);e>0&&this.progressBarController?.addProgress(e)}let e=b.O.getState().getFocusTime();this.player.updateFocusTime(e),this.updateTaskBubble(),this.player.update(this.cursors),this.socketManager.updateRemotePlayers()}updateTaskBubble(){if(!this.player)return;let{isFocusTimerRunning:e}=b.O.getState(),t=x.d.getState().tasks.find(e=>e.isRunning),s=e||!!t,a=t?.description,r={isFocusing:s,taskName:a};(this.lastTaskBubbleState?.isFocusing!==r.isFocusing||this.lastTaskBubbleState?.taskName!==r.taskName)&&(this.lastTaskBubbleState=r,this.player.updateTaskBubble({isFocusing:s,taskName:a}))}}let N={type:i.AUTO,parent:"game-container",scale:{mode:i.Scale.RESIZE,width:"100%",height:"100%"},audio:{noAudio:!0},backgroundColor:"#303032",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[k]};var S=s(9873);function T(){let e=(0,r.useRef)(null),t=(0,S.n)(e=>e.user),{data:s}=(0,n.I)({queryKey:["player","info",t?.playerId],queryFn:()=>o.g.getPlayer(t.playerId),enabled:!!t?.playerId});return(0,r.useEffect)(()=>{if(e.current||!t||!s)return;e.current=new i.Game(N);let a=s.equippedPet?.actualImgUrl||null;e.current.registry.set("user",{...t,petImage:a})},[t,s]),(0,r.useEffect)(()=>()=>{e.current&&(e.current.destroy(!0),e.current=null)},[]),(0,a.jsx)("div",{id:"game-container",className:"h-full w-full"})}},486:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});var a=s(546);let r=(0,s(3059).default)(()=>Promise.resolve(({children:e})=>(0,a.jsx)(a.Fragment,{children:e})),{ssr:!1})},807:(e,t,s)=>{"use strict";function a(e){return e.toISOString().slice(0,10)}function r(e){let t=Math.floor(e/60),s="⏱️";if(t<60)s+=`${t}분`;else{let e=Math.floor(t/60),a=t%60;s+=`${e}시간`,a>0&&(s+=` ${a}분`)}return s}s.d(t,{F:()=>r,H:()=>a})},2177:(e,t,s)=>{"use strict";s.d(t,{default:()=>U});var a=s(546),r=s(842),i=s(6743),n=s(9151),o=s(5355),l=s(8742),c=s(4693),d=s(579),h=s(3393),u=s(4958),m=s(982),p=s(7999),b=s(1879),x=s(133);let g=[{id:"1",title:"Ice Cave",artist:"Lo-Fi",src:"/assets/music/lo-fi/8_bit_ice_cave_lofi.mp3"},{id:"2",title:"A Cup of Tea",artist:"Lo-Fi",src:"/assets/music/lo-fi/A cup of tea.mp3"},{id:"3",title:"Bartender",artist:"Lo-Fi",src:"/assets/music/lo-fi/Bartender.mp3"},{id:"4",title:"Cat Caffe",artist:"Lo-Fi",src:"/assets/music/lo-fi/Cat caffe.mp3"},{id:"5",title:"Chill Lofi R",artist:"Lo-Fi",src:"/assets/music/lo-fi/ChillLofiR.mp3"},{id:"6",title:"Countryside",artist:"Lo-Fi",src:"/assets/music/lo-fi/Countryside.mp3"},{id:"7",title:"Cue",artist:"Lo-Fi",src:"/assets/music/lo-fi/Cue.mp3"},{id:"8",title:"Florist",artist:"Lo-Fi",src:"/assets/music/lo-fi/Florist.mp3"},{id:"9",title:"Lofi Loop",artist:"Lo-Fi",src:"/assets/music/lo-fi/LofiLoop.mp3"},{id:"10",title:"Morning Rain",artist:"Lo-Fi",src:"/assets/music/lo-fi/Morning rain.mp3"},{id:"11",title:"Oceanside",artist:"Lo-Fi",src:"/assets/music/lo-fi/Oceanside.mp3"},{id:"12",title:"Rainy Forest",artist:"Lo-Fi",src:"/assets/music/lo-fi/Rainy Forest.mp3"},{id:"13",title:"Lofi Hiphop",artist:"Lo-Fi",src:"/assets/music/lo-fi/lofihiphop.mp3"}],f="musicPlayer_volume",y="musicPlayer_loopMode",v="musicPlayer_lastTrackId";function w(){let e=localStorage.getItem(f);if(null===e)return .5;let t=parseFloat(e);return Number.isNaN(t)?.5:Math.max(0,Math.min(1,t))}function j(){let e=localStorage.getItem(y);return"OFF"===e||"ALL"===e||"ONE"===e?e:"ALL"}function k(){let e=localStorage.getItem(v);return e&&g.find(t=>t.id===e)||null}function N({isExpanded:e}){let{isPlaying:t,currentTrack:s,volume:i,setVolume:n,isMuted:o,setIsMuted:l,audioRef:N,handlePlayTrack:S,handleTogglePlay:T,handleNext:C,handlePrev:I,handleTrackEnd:F,loopMode:_,toggleLoopMode:R}=function(){let[e,t]=(0,r.useState)(!0),[s,a]=(0,r.useState)(!1),[i,n]=(0,r.useState)(k),[o,l]=(0,r.useState)(w),[c,d]=(0,r.useState)(!1),[h,u]=(0,r.useState)(j),m=(0,r.useRef)(null);(0,r.useEffect)(()=>{m.current&&(m.current.volume=c?0:o)},[o,c]),(0,r.useEffect)(()=>{localStorage.setItem(f,String(o))},[o]),(0,r.useEffect)(()=>{localStorage.setItem(y,h)},[h]),(0,r.useEffect)(()=>{i&&localStorage.setItem(v,i.id)},[i]),(0,r.useEffect)(()=>{m.current&&i&&(s?m.current.play():m.current.pause())},[s,i]);let p=()=>{if(!i){n(g[0]),a(!0);return}let e=(g.findIndex(e=>e.id===i.id)+1)%g.length;n(g[e]),a(!0)};return{isExpanded:e,setIsExpanded:t,isPlaying:s,currentTrack:i,volume:o,setVolume:l,isMuted:c,setIsMuted:d,audioRef:m,handlePlayTrack:e=>{i?.id===e.id?a(!s):(n(e),a(!0))},handleTogglePlay:()=>{!i&&g.length>0?(n(g[0]),a(!0)):a(!s)},handleNext:p,handlePrev:()=>{if(!i){n(g[0]),a(!0);return}let e=g.findIndex(e=>e.id===i.id),t=e<=0?g.length-1:e-1;n(g[t]),a(!0)},handleTrackEnd:()=>{if("ONE"===h)m.current&&(m.current.currentTime=0,m.current.play());else if("OFF"===h){if(!i)return;g.findIndex(e=>e.id===i.id)===g.length-1?a(!1):p()}else p()},loopMode:h,toggleLoopMode:()=>{u(e=>"OFF"===e?"ALL":"ALL"===e?"ONE":"OFF")}}}();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("audio",{ref:N,src:s?.src,onEnded:F,onCanPlay:()=>{if(t&&N.current){let e=N.current.play();e&&e.catch(()=>{})}}}),(0,a.jsxs)("div",{className:e?"block":"hidden",children:[(0,a.jsx)("section",{className:"mb-3 border-2 border-amber-900 bg-white/50 p-2","aria-label":"Now Playing",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"truncate text-xs font-bold text-amber-900",children:["♪ ",s.title]}),(0,a.jsx)("p",{className:"truncate text-xs text-amber-700",children:s.artist})]}):(0,a.jsx)("p",{className:"truncate text-xs font-bold text-amber-700",children:"♪ 재생 중인 곡 없음"})}),(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between",role:"group","aria-label":"Playback Controls",children:[(0,a.jsx)("button",{onClick:R,"aria-label":`Repeat Mode: ${_}`,className:`flex h-8 w-8 cursor-pointer items-center justify-start transition-colors ${"OFF"===_?"text-amber-500 hover:text-amber-900":"text-amber-900"}`,children:"ONE"===_?(0,a.jsx)(c.A,{className:"h-4 w-4"}):(0,a.jsx)(d.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:I,"aria-label":"Previous Track",className:"border-retro-border-dark bg-retro-button-bg hover:bg-retro-button-hover flex h-8 w-8 cursor-pointer items-center justify-center border-2 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.3)] active:translate-x-[1px] active:translate-y-[1px] active:shadow-none",children:(0,a.jsx)(h.A,{className:"text-retro-button-text h-3 w-3"})}),(0,a.jsx)("button",{onClick:T,"aria-label":t?"Pause":"Play",className:"border-retro-border-dark bg-retro-button-bg hover:bg-retro-button-hover flex h-8 w-8 cursor-pointer items-center justify-center border-2 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.3)] active:translate-x-px active:translate-y-px active:shadow-none",children:t?(0,a.jsx)(u.A,{className:"text-retro-button-text h-4 w-4"}):(0,a.jsx)(m.A,{className:"text-retro-button-text h-4 w-4"})}),(0,a.jsx)("button",{onClick:C,"aria-label":"Next Track",className:"border-retro-border-dark bg-retro-button-bg hover:bg-retro-button-hover flex h-8 w-8 cursor-pointer items-center justify-center border-2 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.3)] active:translate-x-px active:translate-y-px active:shadow-none",children:(0,a.jsx)(p.A,{className:"text-retro-button-text h-3 w-3"})})]}),(0,a.jsx)("div",{className:"w-8","aria-hidden":"true"})]}),(0,a.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>l(!o),"aria-label":o||0===i?"Unmute":"Mute",className:"cursor-pointer text-amber-900 hover:text-amber-700",children:o||0===i?(0,a.jsx)(b.A,{className:"h-4 w-4"}):(0,a.jsx)(x.A,{className:"h-4 w-4"})}),(0,a.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:i,onChange:e=>{n(parseFloat(e.target.value)),o&&l(!1)},"aria-label":"Volume Control",className:"h-2 flex-1 cursor-pointer appearance-none bg-amber-300/60 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:bg-amber-700"})]}),(0,a.jsx)("ul",{className:"retro-scrollbar max-h-32 overflow-y-auto border-2 border-amber-900 bg-white/50",children:g.map(e=>(0,a.jsx)("li",{onClick:()=>S(e),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),S(e))},role:"button",tabIndex:0,className:`cursor-pointer p-2 last:border-b-0 ${s?.id===e.id?"bg-retro-button-bg/10":"hover:bg-amber-100"}`,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s?.id===e.id&&t?(0,a.jsx)("span",{className:"text-xs text-amber-900","aria-hidden":"true",children:"▶"}):(0,a.jsx)("span",{className:"text-xs opacity-0","aria-hidden":"true",children:"▶"}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"truncate text-xs font-bold text-amber-900",children:e.title}),(0,a.jsx)("p",{className:"truncate text-xs text-amber-700",children:e.artist})]})]})},e.id))})]}),(0,a.jsx)("div",{className:e?"hidden":"mt-3 border-t border-amber-900/20 pt-3",children:s?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),T()},"aria-label":t?"Pause":"Play",className:"cursor-pointer text-amber-900 hover:text-amber-700",children:t?(0,a.jsx)(u.A,{className:"h-4 w-4"}):(0,a.jsx)(m.A,{className:"h-4 w-4"})}),(0,a.jsxs)("p",{className:"flex-1 truncate text-sm font-semibold text-amber-900",children:["♪ ",s.title]})]}):(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("p",{className:"text-sm text-amber-700",children:"재생 중인 곡 없음"})})})]})}var S=s(8601);function T({message:e}){return e?(0,a.jsx)("div",{role:"alert",className:"border-retro-border-darkest bg-retro-border-light text-retro-delete-hover shadow-retro-sm mb-3 rounded-none border-2 px-3 py-2 text-xs",children:e}):null}function C({time:e,isRunning:t,onToggle:s,error:r}){return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"text-md mb-3 text-amber-900",children:"[ Focus Time ]"}),(0,a.jsx)(T,{message:r}),(0,a.jsx)("div",{className:"mb-4 rounded-none border-3 border-amber-900 bg-white/50 p-6 shadow-[4px_4px_0px_0px_rgba(0,0,0,0.3)]",children:(0,a.jsx)("div",{className:"text-center text-3xl text-amber-900",children:e})}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(S.$,{onClick:s,className:"text-md border-retro-border-darker bg-retro-button-bg text-retro-button-text shadow-retro-lg hover:bg-retro-button-hover flex flex-1 items-center justify-center gap-2 rounded-none border-2 py-1 transition-all active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"h-4 w-4"}),"정지"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"시작"]})})})]})}var I=s(364),F=s(1696),_=s(4652),R=s(3798),P=s(5371),E=s(249);function M({checked:e=!1,disabled:t=!1,onCheckedChange:s,className:r=""}){return(0,a.jsx)("input",{type:"checkbox",checked:e,disabled:t,onChange:e=>s?.(e.target.checked),className:r})}function A({className:e="",...t}){return(0,a.jsx)("input",{className:e,...t})}function D({task:e,displayTime:t,isPending:s,onToggle:i,onDelete:n,onToggleTimer:o,onEdit:l,formatTime:c}){let[d,h]=(0,r.useState)(!1),[p,b]=(0,r.useState)(e.description),x=t=>{t.preventDefault(),!s&&p.trim()&&(l(e.id,p.trim()),h(!1))},g=()=>{b(e.description),h(!1)};return(0,a.jsxs)("div",{className:"group flex items-center gap-3 rounded-none border-2 border-amber-900 bg-white/50 px-3 py-3 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.2)] transition-colors hover:border-amber-800",children:[(0,a.jsx)(M,{checked:e.completed,disabled:s,onCheckedChange:()=>i(e.id),className:"h-5 w-5 rounded-none border-2 border-amber-900 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:border-amber-900 data-[state=checked]:bg-amber-600"}),(0,a.jsx)("div",{className:"min-w-0 flex-1",children:d?(0,a.jsx)(A,{type:"text",value:p,onChange:e=>b(e.target.value),onKeyDown:e=>{e.stopPropagation(),"Enter"===e.key&&x(e),"Escape"===e.key&&g()},className:"h-8 w-full rounded-none border-2 border-amber-900 bg-white px-2 text-sm text-amber-900 disabled:cursor-not-allowed disabled:opacity-50",autoFocus:!0,disabled:s}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:`text-sm ${e.completed?"text-amber-500 line-through":"text-amber-900"}`,children:e.description}),(0,a.jsx)("div",{className:"mt-0.5 text-xs text-amber-700",children:c(t)})]})}),s&&(0,a.jsx)(R.A,{className:"h-4 w-4 animate-spin text-amber-700"}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.$,{type:"button",disabled:s,"aria-label":"작업 수정 저장",className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none disabled:cursor-not-allowed disabled:opacity-50",onClick:x,children:(0,a.jsx)(F.A,{className:"h-4 w-4"})}),(0,a.jsx)(S.$,{type:"button",disabled:s,"aria-label":"작업 수정 취소",className:"border-retro-border-darker bg-retro-button-bg text-retro-button-text shadow-retro-lg hover:bg-retro-button-hover ml-1 flex h-7 w-7 items-center justify-center rounded-none border-2 transition-all active:translate-x-0.5 active:translate-y-0.5 active:shadow-none disabled:cursor-not-allowed disabled:opacity-50",onClick:g,children:(0,a.jsx)(_.A,{className:"h-4 w-4"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.$,{disabled:s,"aria-label":e.isRunning?"타이머 일시정지":"타이머 시작","aria-pressed":e.isRunning,className:`flex h-8 w-8 items-center justify-center rounded-none border-2 transition-all ${e.isRunning?"border-amber-900 bg-amber-600 text-white hover:bg-amber-700":"border-amber-900/50 bg-transparent text-amber-700 hover:bg-amber-100 hover:text-amber-900"} disabled:cursor-not-allowed disabled:opacity-50`,onClick:()=>o(e.id),children:e.isRunning?(0,a.jsx)(u.A,{className:"h-4 w-4"}):(0,a.jsx)(m.A,{className:"h-4 w-4"})}),(0,a.jsx)(S.$,{disabled:s,"aria-label":"작업 편집",className:"flex h-8 w-8 items-center justify-center rounded-none border-2 border-amber-900/50 bg-transparent text-amber-700 transition-all hover:bg-amber-100 hover:text-amber-900 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{h(!0),b(e.description)},children:(0,a.jsx)(P.A,{className:"h-4 w-4"})}),(0,a.jsx)(S.$,{disabled:s,"aria-label":"작업 삭제",className:"flex h-8 w-8 items-center justify-center rounded-none border-2 border-amber-900/50 bg-transparent text-amber-700 transition-all hover:bg-amber-100 hover:text-amber-900 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>n(e.id),children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})]})})]})}function O({tasks:e,completedCount:t,totalCount:s,error:i,pendingTaskIds:n,onAddTask:o,onToggleTask:l,onDeleteTask:c,onToggleTaskTimer:d,onEditTask:h,formatTaskTime:u,getTaskDisplayTime:m}){let[p,b]=(0,r.useState)(""),[x,g]=(0,r.useState)(!1),f=(0,r.useRef)(null);return(0,r.useEffect)(()=>{f.current&&f.current.scrollTo({top:f.current.scrollHeight,behavior:"smooth"})},[e.length]),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-md text-amber-900",children:"[ Tasks ]"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-sm text-amber-900",children:[t,"/",s]}),(0,a.jsx)(S.$,{onClick:()=>{g(!0)},className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,a.jsx)(I.A,{className:"h-4 w-4"})})]})]}),(0,a.jsx)(T,{message:i}),x&&(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),p.trim()&&(o(p.trim()),b(""),g(!1))},className:"mb-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(A,{type:"text",value:p,onChange:e=>b(e.target.value),onKeyDown:e=>e.stopPropagation(),placeholder:"새 작업...",className:"flex-1 rounded-none border-2 border-amber-900 bg-white px-3 py-1 text-sm text-amber-900 placeholder:text-amber-500",autoFocus:!0}),(0,a.jsx)(S.$,{type:"submit",className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,a.jsx)(F.A,{className:"h-4 w-4"})}),(0,a.jsx)(S.$,{type:"button",className:"border-retro-border-darker bg-retro-button-bg text-retro-button-text shadow-retro-lg hover:bg-retro-button-hover flex h-7 w-7 items-center justify-center rounded-none border-2 transition-all active:translate-x-0.5 active:translate-y-0.5 active:shadow-none disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{b(""),g(!1)},children:(0,a.jsx)(_.A,{className:"h-4 w-4"})})]})}),(0,a.jsx)("div",{ref:f,className:"retro-scrollbar max-h-72 space-y-2 overflow-y-auto",children:e.map(e=>(0,a.jsx)(D,{task:e,displayTime:m(e),isPending:n.includes(e.id),onToggle:l,onDelete:c,onToggleTimer:d,onEdit:h,formatTime:u},e.id))})]})}let L=e=>{let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`},$=e=>{let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`};var B=s(4563),K=s(3087),q=s(2983);function G({isExpanded:e,lastRunTaskId:t,setLastRunTaskId:s}){let{tasks:i,isLoading:n,error:o,pendingTaskIds:l,fetchTasks:c,addTask:d,toggleTask:h,deleteTask:p,editTask:b,toggleTaskTimer:x,stopAllTasks:g,getTaskDisplayTime:f,clearTaskError:y}=(0,K.d)((0,q.k)(e=>({tasks:e.tasks,isLoading:e.isLoading,error:e.error,pendingTaskIds:e.pendingTaskIds,fetchTasks:e.fetchTasks,addTask:e.addTask,toggleTask:e.toggleTask,deleteTask:e.deleteTask,editTask:e.editTask,toggleTaskTimer:e.toggleTaskTimer,stopAllTasks:e.stopAllTasks,getTaskDisplayTime:e.getTaskDisplayTime,clearTaskError:e.clearError})));(0,r.useEffect)(()=>{c()},[c]),(0,r.useEffect)(()=>{if(!o)return;let e=window.setTimeout(()=>{y()},3e3);return()=>{window.clearTimeout(e)}},[o,y]);let v=(0,r.useMemo)(()=>i.filter(e=>e.completed).length,[i]),w=(0,r.useMemo)(()=>i.find(e=>e.isRunning),[i]),j=(0,r.useMemo)(()=>w||i.find(e=>e.id===t),[w,i,t]),{getFocusTime:k,baseFocusSeconds:N,isFocusTimerRunning:S,startFocusing:T,stopFocusing:I,focusError:F,clearFocusError:_}=(0,B.O)((0,q.k)(e=>({getFocusTime:e.getFocusTime,baseFocusSeconds:e.baseFocusSeconds,isFocusTimerRunning:e.isFocusTimerRunning,startFocusing:e.startFocusing,stopFocusing:e.stopFocusing,focusError:e.error,clearFocusError:e.clearError}))),R=S||!!w,[P,E]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!R)return;let e=window.setInterval(()=>E(e=>e+1),1e3);return()=>clearInterval(e)},[R]),(0,r.useEffect)(()=>{let e=()=>{"visible"===document.visibilityState&&E(e=>e+1)};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]);let M=(0,r.useMemo)(()=>k(),[P,S,N,k]);(0,r.useEffect)(()=>{if(!F)return;let e=window.setTimeout(()=>{_()},3e3);return()=>{window.clearTimeout(e)}},[F,_]);let A=()=>{R?(I(),g()):(T(),s(null))},D=e=>{let t=i.find(t=>t.id===e);t&&t.isRunning?I():(T(t?.description,t?.id),s(e),t?.completed&&h(e)),x(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:e?"block":"hidden",children:[(0,a.jsx)(C,{time:L(M),isRunning:R,onToggle:A,error:F}),(0,a.jsx)(O,{tasks:i,completedCount:v,totalCount:i.length,onAddTask:d,onToggleTask:e=>{let t=i.find(t=>t.id===e);t?.isRunning&&(I(),x(e)),h(e)},onDeleteTask:p,onToggleTaskTimer:D,onEditTask:b,formatTaskTime:$,getTaskDisplayTime:f,error:o,pendingTaskIds:l})]}),(0,a.jsx)("div",{className:e?"hidden":"mt-3 border-t border-amber-900/20 pt-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),j?D(j.id):A()},className:"cursor-pointer text-amber-900 hover:text-amber-700","aria-label":R?"정지":"시작",children:R?(0,a.jsx)(u.A,{className:"h-5 w-5"}):(0,a.jsx)(m.A,{className:"h-5 w-5"})}),(0,a.jsx)("div",{className:"flex-1 truncate",children:j?(0,a.jsx)("p",{className:"truncate text-sm font-semibold text-amber-900",children:j.description}):(0,a.jsx)("p",{className:"text-sm text-amber-700",children:"Task를 선택해주세요"})}),(0,a.jsx)("span",{className:"font-mono text-sm text-amber-900",children:L(M)})]})})]})}let Y="tasks",z="music";function U(){let[e,t]=(0,r.useState)(Y),[s,c]=(0,r.useState)(!0),[d,h]=(0,r.useState)(null);return(0,a.jsx)("div",{className:"w-80",children:(0,a.jsxs)("div",{className:"border-3 border-amber-900 bg-[#ffecb3] p-4 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.5)]",children:[(0,a.jsxs)("div",{className:`flex items-center justify-between select-none ${s?"mb-4":"mb-0"}`,children:[(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsxs)("button",{onClick:()=>t(Y),className:`flex cursor-pointer items-center gap-1 border-2 border-amber-900 px-3 py-1 text-sm font-bold transition-colors ${e===Y?"bg-amber-900 text-[#ffecb3]":"bg-transparent text-amber-900 hover:bg-amber-100"}`,children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),"Tasks"]}),(0,a.jsxs)("button",{onClick:()=>t(z),className:`flex cursor-pointer items-center gap-1 border-2 border-amber-900 px-3 py-1 text-sm font-bold transition-colors ${e===z?"bg-amber-900 text-[#ffecb3]":"bg-transparent text-amber-900 hover:bg-amber-100"}`,children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),"Music"]})]}),(0,a.jsx)("button",{onClick:()=>c(!s),className:"cursor-pointer text-amber-900 transition-colors hover:text-amber-700",children:s?(0,a.jsx)(o.A,{className:"h-5 w-5"}):(0,a.jsx)(l.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:e===z?"block":"hidden",children:(0,a.jsx)(N,{isExpanded:s})}),(0,a.jsx)("div",{className:e===Y?"block":"hidden",children:(0,a.jsx)(G,{isExpanded:s,lastRunTaskId:d,setLastRunTaskId:h})})]})]})})}},2654:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var a=s(546),r=s(7918),i=s(2983),n=s(7335);function o(){let{toggleModal:e}=(0,n.K)((0,i.k)(e=>({toggleModal:e.toggleModal})));return(0,a.jsx)("button",{onClick:()=>e(n.e.LEADERBOARD),className:"flex h-12 w-12 cursor-pointer items-center justify-center border-3 border-amber-900 bg-[#ffecb3] shadow-[4px_4px_0px_0px_rgba(0,0,0,0.5)] transition-all hover:bg-amber-200 active:translate-x-[2px] active:translate-y-[2px] active:shadow-none","aria-label":"순위표 열기",children:(0,a.jsx)(r.A,{className:"h-6 w-6 text-amber-900"})})}},3087:(e,t,s)=>{"use strict";s.d(t,{d:()=>d});var a=s(7122),r=s(6176);s(9393);var i=s(8087);s(3532),s(6375),s(8145);var n=s(4902),o=s(4563),l=s(8986),c=s(9873);let d=(0,a.v)((e,t)=>{let s=e=>t().pendingTaskIds.includes(e),a=t=>e(e=>({pendingTaskIds:e.pendingTaskIds.includes(t)?e.pendingTaskIds:[...e.pendingTaskIds,t]})),d=t=>e(e=>({pendingTaskIds:e.pendingTaskIds.filter(e=>e!==t)}));return{tasks:[],isLoading:!1,error:null,pendingTaskIds:[],clearError:()=>e({error:null}),fetchTasks:async t=>{let{user:s,isLoading:a}=c.n.getState();if(a)return;let o=s?.playerId;if(!o)return void e({tasks:[],pendingTaskIds:[],error:"로그인이 필요합니다.",isLoading:!1});e({isLoading:!0,error:null});try{let s=(await i.W.getTasks(o,t)).tasks.map(r.Y);e({tasks:s,isLoading:!1})}catch(s){n.K.error("Failed to fetch tasks",{date:t,error:s}),e({error:"Task 목록을 불러오는데 실패했습니다.",isLoading:!1})}},addTask:async t=>{let s=t.trim();if(!s)return void e({error:"Task 내용을 입력해주세요."});if(s.length>100)return void e({error:"Task는 100자 이하로 입력해주세요."});try{let t=await i.W.createTask(s),a=(0,r.Y)(t);e(e=>({tasks:[...e.tasks,a],error:null}))}catch(t){n.K.error("Failed to create task",{error:t}),e({error:"Task 생성에 실패했습니다."})}},toggleTask:async r=>{if(s(r))return;let{tasks:o}=t(),l=o.find(e=>e.id===r);if(l){e({error:null}),a(r),e(e=>({tasks:e.tasks.map(e=>e.id===r?{...e,completed:!e.completed}:e)}));try{l.completed?await i.W.uncompleteTask(r):await i.W.completeTask(r)}catch(t){n.K.error("Failed to toggle task",{id:r,error:t}),e(e=>({tasks:e.tasks.map(e=>e.id===r?{...e,completed:l.completed}:e),error:"Task 상태 변경에 실패했습니다."}))}finally{d(r)}}},deleteTask:async r=>{if(s(r))return;let{tasks:o}=t(),l=o.findIndex(e=>e.id===r),c=l>=0?o[l]:void 0;if(c){e({error:null}),a(r),e(e=>({tasks:e.tasks.filter(e=>e.id!==r)}));try{await i.W.deleteTask(r)}catch(t){n.K.error("Failed to delete task",{id:r,error:t}),e(e=>({tasks:[...e.tasks.slice(0,l),c,...e.tasks.slice(l)],error:"Task 삭제에 실패했습니다."}))}finally{d(r)}}},editTask:async(r,c)=>{let h=c.trim();if(!h)return void e({error:"Task 내용을 입력해주세요."});if(h.length>100)return void e({error:"Task는 100자 이하로 입력해주세요."});if(s(r))return;let{tasks:u}=t(),m=u.find(e=>e.id===r);if(!m)return;e({error:null}),a(r);let p=m.description;e(e=>({tasks:e.tasks.map(e=>e.id===r?{...e,description:h}:e)}));try{if(await i.W.updateTask(r,h),m.isRunning){let{status:e}=o.O.getState();if("FOCUSING"===e){let e=(0,l.Ol)();e?.connected&&e.emit("focus_task_updating",{taskName:h})}}}catch(t){n.K.error("Failed to update task",{id:r,error:t}),e(e=>({tasks:e.tasks.map(e=>e.id===r?{...e,description:p}:e),error:"Task 수정에 실패했습니다."}))}finally{d(r)}},getTaskDisplayTime:e=>e.isRunning&&e.startTimestamp?e.baseTime+Math.floor((Date.now()-e.startTimestamp)/1e3):e.time,toggleTaskTimer:s=>{let{tasks:a}=t();a.find(e=>e.id===s)&&e(e=>({tasks:e.tasks.map(e=>{if(e.id===s)if(!e.isRunning)return{...e,isRunning:!0,baseTime:e.time,startTimestamp:Date.now()};else{let t=e.startTimestamp?Math.floor((Date.now()-e.startTimestamp)/1e3):0,s=e.baseTime+t;return{...e,isRunning:!1,time:s,baseTime:s,startTimestamp:null}}if(e.isRunning&&e.startTimestamp){let t=Math.floor((Date.now()-e.startTimestamp)/1e3),s=e.baseTime+t;return{...e,isRunning:!1,time:s,baseTime:s,startTimestamp:null}}return e})}))},stopAllTasks:()=>e(e=>({tasks:e.tasks.map(e=>{if(e.isRunning&&e.startTimestamp){let t=Math.floor((Date.now()-e.startTimestamp)/1e3),s=e.baseTime+t;return{...e,isRunning:!1,time:s,baseTime:s,startTimestamp:null}}return{...e,isRunning:!1}})}))}})},3187:(e,t,s)=>{"use strict";s.d(t,{default:()=>z});var a=s(546),r=s(7335);let i=(0,s(7122).v)((e,t)=>({points:1e3,addPoints:t=>e(e=>({points:e.points+t})),subtractPoints:s=>{let a=t().points;return!(a<s)&&(e({points:a-s}),!0)},setPoints:t=>e({points:t})}));var n=s(6034),o=s(2983),l=s(842),c=s(4581),d=s(2688),h=s(8601),u=s(807);function m(e,t){return!!t&&e.toDateString()===t.toDateString()}function p({day:e,position:t}){return(0,a.jsxs)("div",{className:"pointer-events-none fixed z-50 rounded-none border-2 border-amber-700 bg-amber-900 px-3 py-2 text-sm text-amber-50 shadow-[2px_2px_0px_0px_#000]",style:{left:t.x+10,top:t.y+10},children:[(0,a.jsx)("div",{children:e.date.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"short"})}),(0,a.jsxs)("div",{className:"mt-1 text-amber-300",children:["Point: ",e.value]})]})}function b({dailyTaskCounts:e,onSelectDate:t,selectedDate:s}){let r,i,[n,o]=(0,l.useState)(0),[b,x]=(0,l.useState)(null),[g,f]=(0,l.useState)({x:0,y:0}),y=(0,l.useRef)(null),{weeks:v}=(r=(0,l.useMemo)(()=>{let t=new Map;e.forEach(e=>{t.set(e.date,e.taskCount)});let s=[],a=new Date,r=new Date(a);r.setFullYear(a.getFullYear()-1);for(let e=new Date(r);e<=a;e.setDate(e.getDate()+1)){let a=(0,u.H)(e);s.push({date:new Date(e),value:t.get(a)||0})}return s},[e]),i=(0,l.useMemo)(()=>{let e=[],t=[],s=r[0].date.getDay();for(let e=0;e<s;e++)t.push({date:new Date(0),value:-1});if(r.forEach(s=>{t.push(s),7===t.length&&(e.push(t),t=[])}),t.length>0){for(;t.length<7;)t.push({date:new Date(0),value:-1});e.push(t)}return e},[r]),{yearData:r,weeks:i}),w=e=>{let t=y.current;if(!t)return;let s="left"===e?Math.max(0,n-200):Math.min(t.scrollWidth-t.clientWidth,n+200);o(s),t.scrollTo({left:s,behavior:"smooth"})},j=(e,t)=>{-1!==t.value&&(x(t),f({x:e.clientX,y:e.clientY}))},k=()=>{x(null)};return(0,l.useEffect)(()=>{let e=y.current;if(!e)return;let t=e.scrollWidth-e.clientWidth;e.scrollTo({left:t,behavior:"auto"}),o(t)},[]),(0,a.jsxs)("div",{className:"mb-6 rounded-none border-2 border-amber-800/20 bg-amber-50 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.$,{onClick:()=>w("left"),className:"h-7 w-7 shrink-0 rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,a.jsx)(c.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"relative flex-1 overflow-hidden",children:(0,a.jsx)("div",{ref:y,className:"scrollbar-hide overflow-x-auto overflow-y-visible",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:(0,a.jsx)("div",{className:"inline-flex gap-1 py-0.5 pr-1",style:{minWidth:"max-content"},children:v.map((e,r)=>(0,a.jsx)("div",{className:"flex flex-col gap-0.75",children:e.map((e,i)=>{var n;return(0,a.jsx)("div",{className:`h-3 w-3 rounded-sm transition-colors ${-1===(n=e.value)?"bg-transparent":0===n?"bg-heatmap-empty":n<5?"bg-heatmap-level-1":n<10?"bg-heatmap-level-2":n<20?"bg-heatmap-level-3":"bg-heatmap-level-4"} ${-1===e.value?"cursor-default":m(e.date,s)?"ring-2 ring-amber-900":"cursor-pointer ring-1 ring-amber-300 hover:ring-2 hover:ring-amber-800"}`,onClick:()=>-1!==e.value&&t(e.date),onMouseEnter:t=>j(t,e),onMouseMove:t=>j(t,e),onMouseLeave:k},`${r}-${i}`)})},r))})})}),(0,a.jsx)(h.$,{onClick:()=>w("right"),className:"h-7 w-7 shrink-0 rounded-none border-2 border-amber-800 bg-amber-700 text-amber-50 shadow-[2px_2px_0px_0px_#78350f] transition-all hover:bg-amber-800 active:translate-x-0.5 active:translate-y-0.5 active:shadow-none",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})]}),b&&-1!==b.value&&(0,a.jsx)(p,{day:b,position:g})]})}var x=s(8169);function g({src:e,alt:t="Mascot"}){let[s,r]=(0,l.useState)(!1),[i,n]=(0,l.useState)(!1),[o,c]=(0,l.useState)(!1),[d,h]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=setInterval(()=>{h(!0),setTimeout(()=>h(!1),3e3)},5e3);return()=>clearInterval(e)},[]),(0,a.jsxs)("div",{className:"group relative size-full",children:[(0,a.jsx)("button",{onMouseEnter:()=>{r(!0),i||n(!0)},onMouseLeave:()=>{r(!1),c(!1)},onMouseDown:()=>c(!0),onMouseUp:()=>c(!1),className:`relative size-full cursor-pointer transition-transform select-none ${s?"translate-y-1":""} ${o?"scale-125":""} ${d?"animate-grass-pet-bounce":""}`,children:(0,a.jsx)(x.default,{src:e,alt:t,fill:!0,className:"object-contain select-none",draggable:!1})}),(0,a.jsx)("div",{className:`pointer-events-none absolute top-0 left-1/2 transition-opacity duration-500 ${s?"opacity-80":"opacity-0"} ${i?"animate-grass-heart-float":""}`,children:(0,a.jsx)("div",{className:`transition-transform select-none ${o?"scale-125":""}`,children:(0,a.jsx)(x.default,{src:"/assets/heart.png",alt:"Heart",width:24,height:24,className:"object-contain select-none",draggable:!1})})})]})}function f(){return(0,a.jsxs)("div",{className:"relative size-60 shrink-0 overflow-visible rounded-none",children:[(0,a.jsx)(x.default,{src:"/assets/grass-base.png",alt:"Garden",fill:!0,className:"scale-115 object-fill",style:{imageRendering:"pixelated"},priority:!0}),(0,a.jsx)("div",{className:"relative grid h-full w-full grid-cols-3 grid-rows-3 p-2",children:Array.from({length:9}).map((e,t)=>(0,a.jsx)("div",{className:"relative flex items-center justify-center",children:0===t&&(0,a.jsx)(g,{src:"/assets/mascot/gopher_stage1.svg",alt:"Gopher"})},t))})]})}function y({title:e,value:t}){return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-none border-2 border-amber-800/20 bg-amber-50 p-1",children:[(0,a.jsx)("h3",{className:"mb-1 text-xs font-bold",children:e}),(0,a.jsx)("p",{className:"text-sm text-amber-700",children:t})]})}function v(e){let t=Math.floor(e/3600),s=Math.floor(e%3600/60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}function w({tasks:e,selectedDate:t,focusTimeSeconds:s,githubEvents:r}){let i=v(s??0),n=m(t,new Date)?e.length:e.filter(e=>e.completed).length;return(0,a.jsxs)("div",{className:"flex h-60 gap-4",children:[(0,a.jsx)(f,{}),(0,a.jsxs)("div",{className:"grid h-full flex-1 grid-cols-3 grid-rows-2 gap-2",children:[(0,a.jsx)(y,{title:"집중시간",value:i}),(0,a.jsx)(y,{title:"TASK",value:String(n)}),(0,a.jsx)(y,{title:"Commit",value:String(r?.committed??0)}),(0,a.jsx)(y,{title:"ISSUE",value:String(r?.issueOpened??0)}),(0,a.jsx)(y,{title:"PR 생성",value:String(r?.prCreated??0)}),(0,a.jsx)(y,{title:"PR 리뷰",value:String(r?.prReviewed??0)})]})]})}function j({tasks:e,selectedDate:t}){let s,r,i,n,o,l=m(t,new Date),c=(s=(0,u.H)(t),e.filter(e=>e.createdDate===s)).filter(e=>l||e.completed);return(0,a.jsxs)("div",{className:"rounded-none border-2 border-amber-800/20 bg-amber-50 p-3",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-bold",children:"Task 목록"}),(0,a.jsx)("p",{className:"text-xs text-amber-700",children:(r=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),o=["일","월","화","수","목","금","토"][t.getDay()],`${r}년 ${i}월 ${String(n).padStart(2,"0")}일 ${o}`)})]}),(0,a.jsx)("div",{className:"space-y-2",children:0===c.length?(0,a.jsx)("div",{className:"py-4 text-center text-xs text-amber-700",children:"이 날짜에 등록된 Task가 없습니다."}):c.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-none border border-amber-200 bg-amber-100/50 p-2 transition-colors hover:border-amber-400",children:[(0,a.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,a.jsx)("div",{className:`h-3 w-3 rounded-none border-2 ${e.completed?"border-amber-700 bg-amber-600":"border-amber-400 bg-transparent"}`}),(0,a.jsx)("span",{className:`text-xs ${e.completed?"text-amber-600 line-through":"text-amber-900"}`,children:e.description})]}),(0,a.jsx)("span",{className:"text-xs text-amber-700",children:v(e.time)})]},e.id))})]})}let k={sm:"h-4 w-4 border-2",md:"h-8 w-8 border-2",lg:"h-12 w-12 border-4"};function N({size:e="md",text:t,className:s=""}){return(0,a.jsxs)("div",{className:`flex flex-col items-center justify-center gap-3 ${s}`,children:[(0,a.jsx)("div",{className:`animate-spin rounded-full border-amber-300 border-t-amber-700 ${k[e]}`}),t&&(0,a.jsx)("span",{className:"text-sm text-amber-800",children:t})]})}let S={points:{all:["points"],list:()=>[...S.points.all,"list"]},focustime:{all:["focustime"],detail:(e,t)=>[...S.focustime.all,e,t]},github:{all:["github"],events:(e,t)=>[...S.github.all,"events",e,t]},tasks:{all:["tasks"],list:(e,t)=>[...S.tasks.all,e,t]}};var T=s(4816),C=s(3532),I=s(6375),F=s(8145),_=s(8087),R=s(6176);function P(){let e=(0,r.K)(e=>e.userInfoPayload?.playerId),[t,s]=(0,l.useState)(new Date),{dailyTaskCounts:i,focusTimeData:n,githubEvents:o,tasks:c,isLoading:d}=function(e,t){let s=(0,u.H)(t),{points:a,isLoading:r}=function(){let{data:e,isLoading:t,error:s,refetch:a}=(0,T.I)({queryKey:S.points.list(),queryFn:C.l.getPoints,staleTime:0});return{points:e??[],isLoading:t,error:s,refetch:a}}(),{focustime:i,isLoading:n}=function(e,t){let{data:s,isLoading:a,error:r,refetch:i}=(0,T.I)({queryKey:S.focustime.detail(e,t),queryFn:()=>I.Q.getFocusTime(e,t),enabled:e>0&&!!t,staleTime:0});return{focustime:s,isLoading:a,error:r,refetch:i}}(e,s),{events:o,isLoading:c}=function(e,t){let{data:s,isLoading:a,error:r,refetch:i}=(0,T.I)({queryKey:S.github.events(e,t),queryFn:()=>F.M.getEvents(e,t),enabled:e>0&&!!t,staleTime:0});return{events:s,isLoading:a,error:r,refetch:i}}(e,s),{tasks:d,isLoading:h}=function(e,t){let{data:s,isLoading:a,error:r,refetch:i}=(0,T.I)({queryKey:S.tasks.list(e,t),queryFn:()=>_.W.getTasks(e,t),enabled:e>0,staleTime:0,refetchOnMount:"always"});return{tasks:s?.tasks??[],isLoading:a,error:r,refetch:i}}(e,s),m=(0,l.useMemo)(()=>d.map(R.Y),[d]);return{dailyTaskCounts:(0,l.useMemo)(()=>a.map(e=>({date:e.createdDate,taskCount:e.amount})),[a]),focusTimeData:i,githubEvents:o,tasks:m,isLoading:r,isDateDataLoading:n||c||h}}(e??0,t);return d?(0,a.jsx)("div",{className:"flex h-96 items-center justify-center",children:(0,a.jsx)(N,{size:"lg",text:"프로필 로딩 중..."})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(b,{dailyTaskCounts:i,selectedDate:t,onSelectDate:s}),(0,a.jsxs)("div",{className:"space-y-4 text-amber-900",children:[(0,a.jsx)(w,{tasks:c,selectedDate:t,focusTimeSeconds:n?.totalFocusSeconds,githubEvents:o}),(0,a.jsx)(j,{tasks:c,selectedDate:t})]})]})}function E(){return(0,a.jsx)("div",{className:"space-y-2 text-amber-900",children:(0,a.jsx)("h3",{className:"mb-2 border-b-2 border-amber-800/20 pb-1 font-bold",children:"최근 활동"})})}var M=s(9147),A=s(2619),D=s(8143),O=s(8986);let L="bg-amber-600 px-4 py-2 hover:bg-amber-500 text-white border-b-4 border-r-4 border-amber-800 active:border-b-0 active:border-r-0 active:translate-y-1 active:translate-x-1 disabled:opacity-50 disabled:cursor-not-allowed";function $({onPetCollected:e,onGacha:t}){let[s,r]=(0,l.useState)("idle"),[n,o]=(0,l.useState)(null),c=i(e=>e.points),d=async()=>{if(c<100)return void alert("포인트가 부족합니다!");r("animating");try{await new Promise(e=>setTimeout(e,5e3));let s=await t();if(s)o(s),r("result"),e(s.id);else throw Error("Unknown pet received")}catch(e){alert("뽑기 실패: "+e),r("idle")}};return(0,a.jsxs)("div",{className:"flex flex-col gap-4 bg-amber-50 p-6 border-4 border-amber-900",children:[(0,a.jsx)("div",{className:"flex items-center justify-between border-b-2 border-amber-900/20 pb-2",children:(0,a.jsx)("h3",{className:"text-xl font-bold text-amber-900",children:"펫 뽑기"})}),(0,a.jsxs)("div",{className:"flex h-60 flex-col items-center justify-center gap-4",children:["idle"===s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"gacha-egg"}),(0,a.jsxs)("p",{className:"text-center text-sm text-amber-700",children:["어떤 펫이 나올까요?",(0,a.jsx)("br",{}),"(1회: 100 P)"]}),(0,a.jsx)("button",{onClick:d,disabled:c<100,className:L,children:"펫 뽑기"})]}),"animating"===s&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"gacha-egg animating"}),(0,a.jsx)("p",{className:"animate-pulse text-lg font-bold text-amber-800",children:"알이 깨지고 있어요!"})]}),"result"===s&&n&&(0,a.jsxs)("div",{className:"animate-pop flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"relative h-24 w-24",children:(0,a.jsx)(x.default,{src:n.actualImgUrl,alt:n.name,fill:!0,className:"object-contain",style:{imageRendering:"pixelated"}})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-amber-900",children:"축하합니다!"}),(0,a.jsxs)("p",{className:"text-sm text-amber-700",children:[(0,a.jsx)("span",{className:"font-bold text-amber-900",children:n.name}),"을(를) 만났습니다!"]})]}),(0,a.jsx)("button",{onClick:()=>{r("idle"),o(null)},className:L,children:"확인"})]})]})]})}function B({exp:e,maxExp:t,currentStageData:s,onAction:r,isOwner:n}){let[o,c]=(0,l.useState)([]),d=i(e=>e.points),h=0===t,u=!h&&e>=t;return(0,a.jsxs)("div",{className:"flex gap-6 bg-amber-50 p-4 border-4 border-amber-900",children:[(0,a.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,a.jsxs)("div",{className:"relative h-32 w-32 drop-shadow-xl",children:[o.map(e=>(0,a.jsx)("div",{className:"flying-heart absolute size-10",style:{"--random-x":`${e.x}px`,left:"50%",top:"0"},children:(0,a.jsx)(x.default,{src:"/assets/heart.png",alt:"Heart",fill:!0,className:"object-contain",style:{imageRendering:"pixelated"}})},e.id)),(0,a.jsx)(x.default,{src:s.image,alt:s.name,fill:!0,className:"object-contain",style:{imageRendering:"pixelated"}})]})}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col justify-between text-sm font-bold",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-widest",children:s.name})}),(0,a.jsx)("p",{className:"text-sm text-amber-700",children:u?"✨ 진화가 가능합니다!":s.description}),(0,a.jsxs)("div",{className:"flex w-full items-end gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"mb-1 flex justify-between text-lg",children:[(0,a.jsx)("span",{children:"EXP"}),(0,a.jsx)("span",{children:h?"MAX":`${e} / ${t}`})]}),(0,a.jsxs)("div",{className:"relative h-6 w-full border-2 border-amber-900 bg-amber-900/10",children:[(0,a.jsx)("div",{className:`h-full transition-all duration-300 ease-out ${u?"animate-pulse bg-amber-500":"bg-green-500"}`,style:{width:h?"100%":`${e/t*100}%`}}),(0,a.jsx)("div",{className:"absolute inset-0 flex",children:[...Array(9)].map((e,t)=>(0,a.jsx)("div",{className:"flex-1 border-r border-amber-900/20"},t))})]})]}),n&&(0,a.jsx)("div",{className:"relative flex w-1/5 justify-center",children:(0,a.jsx)("button",{onClick:()=>{if(r(),!u&&!h){let e=Date.now(),t=40*Math.random()-20;c(s=>[...s,{id:e,x:t}]),setTimeout(()=>{c(t=>t.filter(t=>t.id!==e))},800)}},disabled:h||!u&&d<10,className:`flex h-12 w-full flex-col items-center justify-center rounded text-base leading-tight font-bold transition-all ${h||!u&&d<10?"cursor-not-allowed border-r-4 border-b-4 border-gray-600 bg-gray-400 text-white opacity-70":u?"border-r-4 border-b-4 border-amber-800 bg-amber-600 text-white hover:bg-amber-500 active:translate-x-1 active:translate-y-1 active:border-r-0 active:border-b-0":"bg-green-600 px-2 hover:bg-green-500 text-white border-b-4 border-r-4 border-green-800 active:border-b-0 active:border-r-0 active:translate-y-1 active:translate-x-1"}`,children:(0,a.jsx)("span",{children:u?"✨ 진화":"밥주기 (10 P)"})})})]})]})]})}function K({allPets:e,collectedPetIds:t,equippedPetId:s,onPetSelect:r,isOwner:i}){let n=e.reduce((e,t)=>(e[t.species]||(e[t.species]=[]),e[t.species].push(t),e),{});return(0,a.jsxs)("div",{className:"flex flex-col gap-4 bg-amber-50 p-6 border-4 border-amber-900",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b-2 border-amber-900/20 pb-2",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-amber-900",children:"펫 도감"}),(0,a.jsxs)("span",{className:"text-xs font-bold text-amber-700",children:[t.length," / ",e.length," 수집"]})]}),(0,a.jsx)("div",{className:"flex h-auto flex-col gap-3",children:Object.entries(n).map(([e,n])=>(0,a.jsx)("div",{className:"flex flex-col gap-2 bg-amber-100/50 p-3 shadow-sm",children:(0,a.jsx)("div",{className:"grid w-full grid-cols-[1fr_auto_1fr_auto_1fr] items-center gap-2",children:n.map((e,o)=>{let l=t.includes(e.id),c=e.id===s,d=o===n.length-1;return(0,a.jsxs)("div",{className:"contents",children:[(0,a.jsxs)("div",{onClick:()=>l&&i&&r(e.id),className:`relative flex flex-col items-center justify-center bg-amber-100 p-2 aspect-auto hover:bg-amber-200 transition-colors border-2 border-amber-900/50 w-full ${l&&i?"cursor-pointer":l?"cursor-default":"bg-gray-200"} ${c?"border-amber-600 bg-amber-200":""}`,title:l?e.description:"???",children:[c&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 z-10 rotate-12 rounded border border-red-800 bg-red-500 px-1.5 py-0.5 text-[12px] font-bold text-white shadow-sm",children:"대표펫"}),(0,a.jsx)("div",{className:"relative mb-2 h-14 w-14",children:(0,a.jsx)(x.default,{src:e.actualImgUrl,alt:e.name,fill:!0,className:`object-contain ${l?"":"pointer-events-none opacity-40 brightness-0 grayscale"}`})}),(0,a.jsx)("p",{className:`w-full text-center text-xs font-bold ${l?"text-amber-900":"text-gray-500"}`,children:l?e.name:"???"})]}),!d&&(0,a.jsx)("div",{className:"flex justify-center text-amber-900/40",children:"▶"})]},e.id)})})},e))})]})}var q=s(9873);function G(){let e=(0,r.K)(e=>e.userInfoPayload?.playerId),{user:t}=(0,q.n)(),s=e??0,i=t?.playerId===s,{inventory:n,codex:o,player:c,feed:d,evolve:h,equip:u,gacha:m,allPets:p,isLoading:b}=(e=>{let t=(0,M.jE)(),{data:s=[],isLoading:a}=(0,T.I)({queryKey:["pets","inventory",e],queryFn:()=>D.g.getInventory(e),enabled:!!e,staleTime:0}),{data:r=[],isLoading:i}=(0,T.I)({queryKey:["pets","codex",e],queryFn:()=>D.g.getCodex(e),enabled:!!e,staleTime:0}),{data:n,isLoading:o}=(0,T.I)({queryKey:["player","info",e],queryFn:()=>D.g.getPlayer(e),enabled:!!e,staleTime:0}),{data:l=[],isLoading:c}=(0,T.I)({queryKey:["pets","all"],queryFn:D.g.getAllPets,staleTime:36e5}),d=(0,A.n)({mutationFn:D.g.gacha,onSuccess:()=>{t.invalidateQueries({queryKey:["pets","inventory",e]}),t.invalidateQueries({queryKey:["pets","codex",e]}),t.invalidateQueries({queryKey:["player","info",e]})}}),h=(0,A.n)({mutationFn:e=>D.g.feed(e),onSuccess:()=>{t.invalidateQueries({queryKey:["pets","inventory",e]}),t.invalidateQueries({queryKey:["player","info",e]})}}),u=(0,A.n)({mutationFn:e=>D.g.evolve(e),onSuccess:()=>{t.invalidateQueries({queryKey:["pets","inventory",e]}),t.invalidateQueries({queryKey:["pets","codex",e]})}}),m=(0,A.n)({mutationFn:e=>D.g.equipPet(e),onSuccess:(s,a)=>{t.invalidateQueries({queryKey:["player","info",e]});let r=(0,O.Ol)();if(r?.connected&&r.emit("pet_equipping",{petId:a}),!l||0===l.length)return void console.warn("allPets not loaded yet for local update");let i=l.find(e=>e.id===a);if(i&&1){let e=i.actualImgUrl;window.dispatchEvent(new CustomEvent("local_pet_update",{detail:{petImage:e}}))}}});return{inventory:s,codex:r,allPets:l,player:n,isLoading:a||i||o||c,gacha:d.mutateAsync,feed:h.mutateAsync,evolve:u.mutateAsync,equip:m.mutateAsync}})(s),[x,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{g(null)},[s]),(0,l.useEffect)(()=>{null===x&&!b&&(c?.equippedPetId?g(c.equippedPetId):n.length>0&&g(n[0].pet.id))},[c,n,b]);let f=p.find(e=>e.id===x),y=n.find(e=>e.pet.id===x),v=!y,w=y?.exp||0,j=f?.evolutionRequiredExp||0,k=v||!f?0:j,N=f?{stage:f.evolutionStage,name:f.name,description:f.description,image:f.actualImgUrl,maxExp:j}:null,S=0!==k&&w>=k,C=async()=>{if(!y)return void alert("보유하지 않은 펫입니다!");try{if(S){let e=await h(y.id);g(e.pet.id);try{await u(e.pet.id)}catch(e){console.error("Auto-equip failed after evolution:",e)}}else await d(y.id)}catch(e){alert("작업 실패: "+e)}},I=async e=>{if(0===n.length){g(e);try{await u(e)}catch(e){console.error("Auto-equip first pet failed:",e)}}},F=async()=>(await m()).pet,_=async e=>{if(g(e),i)try{await u(e)}catch(e){console.error("Failed to equip pet:",e)}};return!s||0===p.length&&b?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsxs)("div",{className:"flex h-auto flex-col gap-4 text-amber-900",children:[N?(0,a.jsx)(B,{exp:w,maxExp:k,currentStageData:N,onAction:C,isOwner:i}):(0,a.jsxs)("div",{className:"border-4 border-amber-900/20 bg-amber-50 p-8 text-center text-amber-700",children:[(0,a.jsx)("p",{className:"text-lg font-bold",children:"보유한 펫이 없습니다"}),i&&(0,a.jsx)("p",{className:"text-sm",children:"아래에서 새로운 펫을 받아보세요!"})]}),i&&(0,a.jsx)($,{onGacha:F,onPetCollected:I}),(0,a.jsx)(K,{allPets:p,collectedPetIds:o,equippedPetId:x||-1,onPetSelect:_,isOwner:i})]})}let Y="border-3 border-amber-900";function z(){let{activeModal:e,userInfoPayload:t,closeModal:s}=(0,r.K)((0,o.k)(e=>({activeModal:e.activeModal,userInfoPayload:e.userInfoPayload,closeModal:e.closeModal}))),c=e===r.e.USER_INFO,d=t?.username,[h,u]=(0,l.useState)("profile"),m=i(e=>e.points),p=(0,l.useCallback)(()=>{s(),u("profile")},[s]),{contentRef:b,handleClose:x,handleBackdropClick:g}=(0,n.T)({isOpen:c,onClose:p});return c?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-10",onClick:g,children:(0,a.jsxs)("div",{ref:b,className:`modal-w:max-w-4xl modal-w:min-w-[850px] relative w-full max-w-2xl min-w-0 bg-[#ffecb3] ${Y} p-3 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.5)]`,children:[(0,a.jsxs)("div",{className:"mb-4 flex items-start justify-between",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)("h2",{className:"text-xl font-extrabold tracking-wider text-amber-900",children:d})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 rounded border-2 border-amber-900/20 bg-amber-100 px-3 py-1 font-bold text-amber-800",children:(0,a.jsxs)("span",{children:[m.toLocaleString()," P"]})}),(0,a.jsx)("button",{onClick:x,className:`flex h-8 w-8 cursor-pointer items-center justify-center ${Y} bg-red-400 leading-none font-bold text-white shadow-[2px_2px_0px_0px_rgba(30,30,30,0.3)] hover:bg-red-500 active:translate-x-[2px] active:translate-y-[2px] active:shadow-none`,children:"X"})]})]}),(0,a.jsxs)("div",{className:"mb-0 flex gap-1",children:[(0,a.jsx)(U,{label:"프로필",isActive:"profile"===h,onClick:()=>u("profile")}),(0,a.jsx)(U,{label:"활동",isActive:"activity"===h,onClick:()=>u("activity")}),(0,a.jsx)(U,{label:"펫",isActive:"pet"===h,onClick:()=>u("pet")})]}),(0,a.jsxs)("div",{className:`my-2 bg-white/50 p-4 ${Y} retro-scrollbar modal-content-height overflow-y-auto`,children:["profile"===h&&(0,a.jsx)(P,{}),"activity"===h&&(0,a.jsx)(E,{}),"pet"===h&&(0,a.jsx)(G,{})]})]})}):null}function U({label:e,isActive:t,onClick:s}){return(0,a.jsx)("button",{onClick:s,className:`flex-1 cursor-pointer py-2 text-sm font-bold transition-all ${Y} ${t?"bg-amber-600 text-white":"bg-amber-200 text-amber-900 hover:bg-amber-300"} ${t&&"hover:brightness-110"}`,children:e})}},3532:(e,t,s)=>{"use strict";s.d(t,{l:()=>r});var a=s(9393);let r={getPoints:()=>(0,a.Z)("/api/points")}},4563:(e,t,s)=>{"use strict";s.d(t,{M:()=>i,O:()=>n});var a=s(7122),r=s(8986);let i={FOCUSING:"FOCUSING",RESTING:"RESTING"},n=(0,a.v)((e,t)=>({status:i.RESTING,isFocusTimerRunning:!1,error:null,baseFocusSeconds:0,serverCurrentSessionSeconds:0,serverReceivedAt:0,getFocusTime:()=>{let{status:e,baseFocusSeconds:s,serverCurrentSessionSeconds:a,serverReceivedAt:r}=t();return e===i.FOCUSING&&r>0?s+a+Math.max(0,Math.floor((Date.now()-r)/1e3)):s},setFocusTime:t=>e({baseFocusSeconds:t}),resetFocusTime:()=>e({baseFocusSeconds:0,serverCurrentSessionSeconds:0,serverReceivedAt:0}),setFocusTimerRunning:t=>e({isFocusTimerRunning:t}),clearError:()=>e({error:null}),startFocusing:(s,a)=>{let n=t(),o=void 0!==a;if("FOCUSING"===n.status&&!o)return;let l=(0,r.Ol)();if(!l?.connected)return void e({error:"서버와 연결되지 않았습니다. 잠시 후 다시 시도해주세요."});let c=n.getFocusTime();e({status:i.FOCUSING,isFocusTimerRunning:!0,baseFocusSeconds:c,serverCurrentSessionSeconds:0,serverReceivedAt:Date.now(),error:null}),l.emit("focusing",{taskName:s,taskId:a},t=>{t?.success||e({status:n.status,isFocusTimerRunning:n.isFocusTimerRunning,baseFocusSeconds:n.baseFocusSeconds,serverCurrentSessionSeconds:n.serverCurrentSessionSeconds,serverReceivedAt:n.serverReceivedAt,error:t?.error||"집중 시작에 실패했습니다."})})},stopFocusing:()=>{let s=t();if(s.status===i.RESTING)return;let a=(0,r.Ol)();if(!a?.connected)return void e({error:"서버와 연결되지 않았습니다. 잠시 후 다시 시도해주세요."});let n=s.getFocusTime();e({status:i.RESTING,isFocusTimerRunning:!1,baseFocusSeconds:n,serverCurrentSessionSeconds:0,serverReceivedAt:0,error:null}),a.emit("resting",{},t=>{t?.success||e({status:s.status,isFocusTimerRunning:s.isFocusTimerRunning,baseFocusSeconds:s.baseFocusSeconds,serverCurrentSessionSeconds:s.serverCurrentSessionSeconds,serverReceivedAt:s.serverReceivedAt,error:t?.error||"휴식 전환에 실패했습니다."})})},syncFromServer:t=>{let s=t.status===i.FOCUSING;e({status:t.status,isFocusTimerRunning:s,baseFocusSeconds:t.totalFocusSeconds,serverCurrentSessionSeconds:s?t.currentSessionSeconds:0,serverReceivedAt:s?Date.now():0,error:null})}}))},4902:(e,t,s)=>{"use strict";s.d(t,{K:()=>a});let a={error:(...e)=>{},warn:(...e)=>{},info:(...e)=>{},log:(...e)=>{}}},6034:(e,t,s)=>{"use strict";s.d(t,{T:()=>r});var a=s(842);function r({isOpen:e,onClose:t}){let s=(0,a.useRef)(null),r=(0,a.useRef)(t);(0,a.useEffect)(()=>{r.current=t},[t]);let i=(0,a.useCallback)(()=>{r.current()},[]);(0,a.useEffect)(()=>{if(!e)return;let t=e=>{"Escape"===e.key&&i()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,i]);let n=(0,a.useCallback)(e=>{s.current&&!s.current.contains(e.target)&&i()},[i]);return{contentRef:s,handleClose:i,handleBackdropClick:n}}},6176:(e,t,s)=>{"use strict";function a(e){return{id:e.id,description:e.description,completed:e.isCompleted,time:e.totalFocusSeconds,baseTime:e.totalFocusSeconds,startTimestamp:null,isRunning:!1,createdDate:e.createdDate}}s.d(t,{Y:()=>a})},6375:(e,t,s)=>{"use strict";s.d(t,{Q:()=>r});var a=s(9393);let r={getFocusTime:(e,t)=>(0,a.Z)(`/api/focustime/${e}?date=${t}`)}},6873:(e,t,s)=>{Promise.resolve().then(s.bind(s,8450)),Promise.resolve().then(s.bind(s,486)),Promise.resolve().then(s.bind(s,94)),Promise.resolve().then(s.bind(s,2177)),Promise.resolve().then(s.bind(s,2654)),Promise.resolve().then(s.bind(s,7084)),Promise.resolve().then(s.bind(s,3187))},7084:(e,t,s)=>{"use strict";s.d(t,{default:()=>h});var a=s(546),r=s(7335),i=s(6034),n=s(2983),o=s(842);function l(e){return String(e).padStart(2,"0")}function c({player:e,className:t="",isMyRank:s=!1}){var r,i;let n=1===(r=e.rank)?"text-yellow-500":2===r?"text-gray-400":3===r?"text-[#CD7F32]":"text-amber-900",o=(i=e.rank)<=3?`No.${i}`:i;return(0,a.jsxs)("div",{className:`grid grid-cols-4 items-center gap-2 py-2 rounded border-2 ${s?"border-blue-400 bg-blue-50":"border-amber-900/20 bg-amber-50 mb-2"} ${t}`,children:[(0,a.jsx)("span",{className:`text-center text-lg font-bold ${n}`,children:o}),(0,a.jsx)("div",{className:"flex justify-center",children:e.profileImage?(0,a.jsx)("img",{src:e.profileImage,alt:e.username,width:40,height:40,className:"h-10 w-10 rounded-full"}):(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-green-400 text-sm font-bold text-white",children:e.username.slice(0,2)})}),(0,a.jsx)("span",{className:"text-center font-medium text-amber-900",children:e.username}),(0,a.jsx)("span",{className:"text-center font-bold text-amber-900",children:e.points})]})}let d="border-3 border-amber-900";function h(){let{activeModal:e,closeModal:t}=(0,r.K)((0,n.k)(e=>({activeModal:e.activeModal,closeModal:e.closeModal}))),s=e===r.e.LEADERBOARD,[h,u]=(0,o.useState)(0),{contentRef:m,handleClose:p,handleBackdropClick:b}=(0,i.T)({isOpen:s,onClose:t}),x=(0,o.useMemo)(()=>s?{seasonEndTime:new Date(Date.now()+6048e5+0+0).toISOString(),players:[{rank:1,username:"ldh-dodo",profileImage:"https://github.com/ldh-dodo.png",points:131},{rank:2,username:"heisjun",profileImage:"https://github.com/heisjun.png",points:98},{rank:3,username:"songhaechan",profileImage:"https://github.com/songhaechan.png",points:76},{rank:4,username:"honki12345",profileImage:"https://github.com/honki12345.png",points:54}],myRank:{rank:1,username:"ldh-dodo",profileImage:"https://github.com/ldh-dodo.png",points:131}}:null,[s]),g=(0,o.useMemo)(()=>x?function(e){let t=new Date(e).getTime()-Date.now();if(t<=0)return{days:0,hours:0,minutes:0,seconds:0};let s=Math.floor(t/864e5),a=Math.floor(t%864e5/36e5);return{days:s,hours:a,minutes:Math.floor(t%36e5/6e4),seconds:Math.floor(t%6e4/1e3)}}(x.seasonEndTime):{days:0,hours:0,minutes:0,seconds:0},[x,h]);return((0,o.useEffect)(()=>{if(!s||!x)return;let e=setInterval(()=>{u(e=>e+1)},1e3);return()=>clearInterval(e)},[s,x]),s&&x)?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-10",onClick:b,children:(0,a.jsxs)("div",{ref:m,role:"dialog","aria-modal":"true","aria-labelledby":"leaderboard-title",className:`relative w-full max-w-lg bg-[#ffecb3] ${d} p-4 shadow-[8px_8px_0px_0px_rgba(0,0,0,0.5)]`,children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{id:"leaderboard-title",className:"text-xl font-extrabold tracking-wider text-amber-900",children:"순위표"}),(0,a.jsx)("button",{onClick:p,"aria-label":"리더보드 모달 닫기",className:`flex h-8 w-8 cursor-pointer items-center justify-center ${d} bg-red-400 leading-none font-bold text-white shadow-[2px_2px_0px_0px_rgba(30,30,30,0.3)] hover:bg-red-500 active:translate-x-[2px] active:translate-y-[2px] active:shadow-none`,children:"X"})]}),(0,a.jsxs)("div",{className:"mb-4 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-amber-700",children:"현재 시즌 타이머"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-amber-900",children:[g.days,"d : ",l(g.hours)," :"," ",l(g.minutes)," : ",l(g.seconds)]})]}),(0,a.jsxs)("div",{className:`${d} bg-white/50 p-3`,children:[(0,a.jsx)("h3",{className:"mb-3 text-center text-lg font-bold text-amber-900",children:"주간 순위"}),(0,a.jsxs)("div",{className:"mb-2 grid grid-cols-4 gap-2 border-b-2 border-amber-900/30 pb-2 text-sm font-bold text-amber-700",children:[(0,a.jsx)("span",{className:"text-center",children:"순위"}),(0,a.jsx)("span",{className:"text-center",children:"프로필 사진"}),(0,a.jsx)("span",{className:"text-center",children:"깃허브 네임"}),(0,a.jsx)("span",{className:"text-center",children:"포인트"})]}),(0,a.jsx)("div",{className:"retro-scrollbar -mr-3 max-h-60 space-y-2 overflow-y-auto",children:x.players.map(e=>(0,a.jsx)(c,{player:e},e.rank))}),(0,a.jsx)("div",{className:"mt-3 border-t-2 border-amber-900/30 pt-3",children:(0,a.jsx)(c,{player:x.myRank,isMyRank:!0})})]})]})}):null}},7335:(e,t,s)=>{"use strict";s.d(t,{K:()=>i,e:()=>r});var a=s(7122);let r={USER_INFO:"userInfo",LEADERBOARD:"leaderboard"},i=(0,a.v)((e,t)=>({activeModal:null,userInfoPayload:null,openModal:(t,s)=>{t!==r.USER_INFO||s?e({activeModal:t,userInfoPayload:s||null}):console.warn("UserInfo modal requires payload")},closeModal:()=>e({activeModal:null,userInfoPayload:null}),toggleModal:(s,a)=>{let{activeModal:i}=t();if(i===s)e({activeModal:null,userInfoPayload:null});else{if(s===r.USER_INFO&&!a)return void console.warn("UserInfo modal requires payload");e({activeModal:s,userInfoPayload:s===r.USER_INFO?a:null})}}}))},8087:(e,t,s)=>{"use strict";s.d(t,{W:()=>r});var a=s(9393);let r={getTasks:(e,t)=>(0,a.Z)(`/api/tasks/${e}${t?`?date=${encodeURIComponent(t)}`:""}`),createTask:e=>(0,a.Z)("/api/tasks",{method:"POST",body:JSON.stringify({description:e})}),updateTask:(e,t)=>(0,a.Z)(`/api/tasks/${e}`,{method:"PATCH",body:JSON.stringify({description:t})}),completeTask:e=>(0,a.Z)(`/api/tasks/completion/${e}`,{method:"PATCH"}),uncompleteTask:e=>(0,a.Z)(`/api/tasks/uncompletion/${e}`,{method:"PATCH"}),deleteTask:e=>(0,a.Z)(`/api/tasks/${e}`,{method:"DELETE"})}},8143:(e,t,s)=>{"use strict";s.d(t,{g:()=>r});var a=s(9393);let r={getInventory:e=>(0,a.Z)(`/api/pets/inventory/${e}`),gacha:()=>(0,a.Z)("/api/pets/gacha",{method:"POST"}),feed:e=>(0,a.Z)("/api/pets/feed",{method:"POST",body:JSON.stringify({userPetId:e})}),evolve:e=>(0,a.Z)("/api/pets/evolve",{method:"POST",body:JSON.stringify({userPetId:e})}),equipPet:e=>(0,a.Z)("/api/players/me/equipped-pet",{method:"PATCH",body:JSON.stringify({petId:e})}),getCodex:e=>(0,a.Z)(`/api/pets/codex/${e}`),getAllPets:()=>(0,a.Z)("/api/pets/all"),getPlayer:e=>(0,a.Z)(`/api/players/${e}/info`)}},8145:(e,t,s)=>{"use strict";s.d(t,{M:()=>r});var a=s(9393);let r={getEvents:(e,t)=>(0,a.Z)(`/api/github/events?playerId=${e}&date=${t}`)}},8450:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var a=s(546),r=s(2922),i=s(842),n=s(9873);function o({children:e}){let t=(0,r.useRouter)(),{isAuthenticated:s,isLoading:o,fetchUser:l}=(0,n.n)();return((0,i.useEffect)(()=>{l()},[l]),(0,i.useEffect)(()=>{o||s||t.replace("/login")},[o,s,t]),o)?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-4 border-gray-600 border-t-white"}),(0,a.jsx)("p",{className:"text-white",children:"로딩 중..."})]})}):s?(0,a.jsx)(a.Fragment,{children:e}):null}},8601:(e,t,s)=>{"use strict";s.d(t,{$:()=>r});var a=s(546);function r({className:e="",children:t,...s}){return(0,a.jsx)("button",{className:e,...s,children:t})}s(842)},8986:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>i,c:()=>o,cH:()=>n});var a=s(5893);let r=null,i=()=>(r||(r=(0,a.io)("https://jandiplease.duckdns.org",{transports:["websocket"],withCredentials:!0,autoConnect:!1,reconnection:!1})),r),n=()=>{let e=i();return e.connected||e.connect(),e},o=(e,t)=>{let s=i();s.connected&&s.emit(e,t)}},9393:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(4902);async function r(e,t){try{let s=await fetch(`https://jandiplease.duckdns.org${e}`,{...t,credentials:"include",headers:{"Content-Type":"application/json",...t?.headers}}),a=await s.text();if(!s.ok){if(401===s.status)throw window.location.href="/login",Error("Unauthorized");let e=`API Error: ${s.status}`;if(a)try{let t=JSON.parse(a),s=t&&"string"==typeof t&&t||t&&"object"==typeof t&&(t.message??t.error??t.detail);s&&(Array.isArray(s)?e+=` - ${s.join(", ")}`:"string"==typeof s?e+=` - ${s}`:e+=` - ${JSON.stringify(s)}`)}catch{let t=a.length>200?`${a.slice(0,197)}...`:a;e+=` - ${t}`}throw Error(e)}return a?JSON.parse(a):{}}catch(s){throw a.K.error("fetchApi failed",{endpoint:e,method:t?.method??"GET",error:s}),s}}},9873:(e,t,s)=>{"use strict";s.d(t,{n:()=>n});var a=s(7122),r=s(4902);let i="https://jandiplease.duckdns.org",n=(0,a.v)(e=>({user:null,isLoading:!0,isAuthenticated:!1,fetchUser:async()=>{try{e({isLoading:!0});let t=await fetch(`${i}/auth/me`,{credentials:"include"});if(t.ok){let s=await t.json();e({user:s,isAuthenticated:!0,isLoading:!1})}else e({user:null,isAuthenticated:!1,isLoading:!1})}catch(t){r.K.error("Failed to fetch user",{error:t}),e({user:null,isAuthenticated:!1,isLoading:!1})}},logout:()=>{window.location.href=`${i}/auth/logout`}}))}},e=>{e.O(0,[536,438,41,580,758,358],()=>e(e.s=6873)),_N_E=e.O()}]);