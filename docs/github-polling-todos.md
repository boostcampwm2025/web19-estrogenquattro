# GitHub Polling ê°œì„  ì‘ì—…

> ê´€ë ¨ PR: [#35 feat: public api(ì¸ì¦X) github í´ë§ ë° ë¸Œë¡œë“œ ìºìŠ¤íŒ…](https://github.com/boostcampwm2025/web19-estrogenquattro/pull/35)
> ì°¸ê³  ë¬¸ì„œ: [GITHUB_API_STRATEGY.md](./GITHUB_API_STRATEGY.md)

## ëª©í‘œ

- Public API â†’ OAuth í† í° ì¸ì¦ APIë¡œ ì „í™˜
- ETagë¥¼ í™œìš©í•œ Conditional Requestë¡œ Rate Limit ìµœì í™”
- í´ë§ ì£¼ê¸° ë‹¨ì¶• (60ì´ˆ â†’ 10~30ì´ˆ)ìœ¼ë¡œ ì‹¤ì‹œê°„ì„± í–¥ìƒ

---

## í˜„ì¬ ìƒíƒœ vs ëª©í‘œ

| í•­ëª© | í˜„ì¬ | ëª©í‘œ |
|------|------|------|
| ì‚¬ìš©ì ì‹ë³„ | í•˜ë“œì½”ë”© (`songhaechan`) | ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ username |
| API ì¸ì¦ | Public API (ì¸ì¦X) | OAuth Access Token |
| Rate Limit | 60 req/hour (ë¹„ì¸ì¦) | 5,000 req/hour (ì¸ì¦) |
| í´ë§ ì£¼ê¸° | 60ì´ˆ | 10~30ì´ˆ |
| ETag ìµœì í™” | ë¯¸ì ìš© | ì ìš© |

---

## Phase 1: OAuth í† í° ì—°ë™

| ìˆœì„œ | ì‘ì—… | í…ŒìŠ¤íŠ¸ ë°©ë²• | ìƒíƒœ |
|:---:|------|-------------|:---:|
| 1 | `GithubPollService`ì—ì„œ ì‚¬ìš©ìë³„ Access Token ì¡°íšŒ | ì½˜ì†”ì— í† í° ë¡œê¹… í›„ í™•ì¸ | âœ… |
| 2 | API í˜¸ì¶œ ì‹œ `Authorization: Bearer {token}` í—¤ë” ì¶”ê°€ | ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ Request Headers í™•ì¸ | âœ… |
| 3 | í•˜ë“œì½”ë”©ëœ username â†’ JWTì—ì„œ ì¶”ì¶œí•œ usernameìœ¼ë¡œ ë³€ê²½ | ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ API URL í™•ì¸ | âœ… |

### ì½”ë“œ í’ˆì§ˆ ì²´í¬

| í•­ëª© | ëª…ë ¹ì–´ | ìƒíƒœ |
|:---:|--------|:---:|
| Lint | `npm run lint` | âœ… |
| Format | `npm run format` | âœ… |
| Build | `npm run build` | âœ… |
| Test | `npm run test` | âœ… |

### ë³´ì•ˆ ì²´í¬

| í•­ëª© | í™•ì¸ ë‚´ìš© | ìƒíƒœ |
|:---:|----------|:---:|
| í† í° ì €ì¥ | accessTokenì´ ë©”ëª¨ë¦¬(UserStore)ì—ë§Œ ì €ì¥ë˜ëŠ”ì§€ | âœ… |
| ë¡œê·¸ ë…¸ì¶œ | accessTokenì´ ë¡œê·¸ì— ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ì§€ | âœ… |
| í´ë¼ì´ì–¸íŠ¸ ì „ì†¡ | accessTokenì´ Socket/API ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ì§€ | âœ… (ìˆ˜ì •ë¨) |
| JWT í¬í•¨ ì—¬ë¶€ | JWT payloadì— accessTokenì´ í¬í•¨ë˜ì§€ ì•ŠëŠ”ì§€ | âœ… |

### í…ŒìŠ¤íŠ¸: OAuth í† í° ì ìš© í™•ì¸

```
1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ > Network íƒ­ ì—´ê¸°
2. GitHub ë¡œê·¸ì¸ í›„ ë°© ì…ì¥
3. ë°±ì—”ë“œ ë¡œê·¸ì—ì„œ GitHub API í˜¸ì¶œ í™•ì¸
4. ì‘ë‹µ í—¤ë”ì˜ X-RateLimit-Limit í™•ì¸
   - 60 â†’ Public API (ì‹¤íŒ¨)
   - 5000 â†’ ì¸ì¦ API (ì„±ê³µ)
```

---

## Phase 2: ETag Conditional Request êµ¬í˜„

| ìˆœì„œ | ì‘ì—… | í…ŒìŠ¤íŠ¸ ë°©ë²• | ìƒíƒœ |
|:---:|------|-------------|:---:|
| 4 | `etagMap: Map<userId, string>` ì¶”ê°€ | - | âœ… |
| 5 | ì‘ë‹µ í—¤ë”ì—ì„œ ETag ì¶”ì¶œ ë° ì €ì¥ | ë¡œê·¸ì—ì„œ ETag ê°’ í™•ì¸ | âœ… |
| 6 | ìš”ì²­ ì‹œ `If-None-Match: {etag}` í—¤ë” ì¶”ê°€ | ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ Request Headers í™•ì¸ | âœ… |
| 7 | 304 ì‘ë‹µ ì²˜ë¦¬ (ë³€ê²½ ì—†ìŒ â†’ API í˜¸ì¶œ ìŠ¤í‚µ) | ë¡œê·¸ì—ì„œ 304 ì‘ë‹µ í™•ì¸ | âœ… |

### ì½”ë“œ í’ˆì§ˆ ì²´í¬

| í•­ëª© | ëª…ë ¹ì–´ | ìƒíƒœ |
|:---:|--------|:---:|
| Lint | `npm run lint` | âœ… |
| Format | `npm run format` | âœ… |
| Build | `npm run build` | âœ… |
| Test | `npm run test` | âœ… |

### ë³´ì•ˆ ì²´í¬

| í•­ëª© | í™•ì¸ ë‚´ìš© | ìƒíƒœ |
|:---:|----------|:---:|
| ETag ë…¸ì¶œ | ETag ê°’ì´ í´ë¼ì´ì–¸íŠ¸ì— ë¶ˆí•„ìš”í•˜ê²Œ ì „ì†¡ë˜ì§€ ì•ŠëŠ”ì§€ | âœ… |
| ì—ëŸ¬ ì •ë³´ | 304/ì—ëŸ¬ ì‘ë‹µ ì‹œ ë¯¼ê° ì •ë³´ê°€ ë¡œê·¸ì— ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ì§€ | âœ… |

### í…ŒìŠ¤íŠ¸: ETag ë™ì‘ í™•ì¸

```
1. ë¸Œë¼ìš°ì € Network íƒ­ ë˜ëŠ” ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
2. ì²« ë²ˆì§¸ í´ë§: 200 OK + ë°ì´í„° ë°˜í™˜
3. GitHub í™œë™ ì—†ì´ ëŒ€ê¸°
4. ë‘ ë²ˆì§¸ í´ë§: 304 Not Modified (rate limit ë¯¸ì°¨ê°)
5. GitHubì—ì„œ ì»¤ë°‹ í‘¸ì‹œ
6. ì„¸ ë²ˆì§¸ í´ë§: 200 OK + ìƒˆ ë°ì´í„° ë°˜í™˜
```

### í…ŒìŠ¤íŠ¸: Rate Limit ì ˆì•½ í™•ì¸

```
ì‘ë‹µ í—¤ë” í™•ì¸:
- X-RateLimit-Limit: 5000
- X-RateLimit-Remaining: ë‚¨ì€ íšŸìˆ˜
- X-RateLimit-Used: ì‚¬ìš©í•œ íšŸìˆ˜

304 ì‘ë‹µ ì‹œ X-RateLimit-Usedê°€ ì¦ê°€í•˜ì§€ ì•Šìœ¼ë©´ ì„±ê³µ
```

---

## Phase 3: í´ë§ ì£¼ê¸° ìµœì í™”

| ìˆœì„œ | ì‘ì—… | í…ŒìŠ¤íŠ¸ ë°©ë²• | ìƒíƒœ |
|:---:|------|-------------|:---:|
| 8 | í´ë§ ì£¼ê¸°ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ë¶„ë¦¬ (`GITHUB_POLL_INTERVAL`) | .env ë³€ê²½ í›„ ì¬ì‹œì‘í•˜ì—¬ í™•ì¸ | â¬œ |
| 9 | í´ë§ ì£¼ê¸° 60ì´ˆ â†’ 30ì´ˆë¡œ ë‹¨ì¶• | ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ìš”ì²­ ê°„ê²© í™•ì¸ | â¬œ |
| 10 | (ì„ íƒ) ETag ê¸°ë°˜ adaptive polling êµ¬í˜„ | - | â¬œ |

### ì½”ë“œ í’ˆì§ˆ ì²´í¬

| í•­ëª© | ëª…ë ¹ì–´ | ìƒíƒœ |
|:---:|--------|:---:|
| Lint | `npm run lint` | â¬œ |
| Format | `npm run format` | â¬œ |
| Build | `npm run build` | â¬œ |
| Test | `npm run test` | â¬œ |

### ë³´ì•ˆ ì²´í¬

| í•­ëª© | í™•ì¸ ë‚´ìš© | ìƒíƒœ |
|:---:|----------|:---:|
| í™˜ê²½ë³€ìˆ˜ | í´ë§ ì£¼ê¸° í™˜ê²½ë³€ìˆ˜ê°€ ì ì ˆí•œ ë²”ìœ„ë¡œ ì œí•œë˜ëŠ”ì§€ | â¬œ |
| DoS ë°©ì§€ | ë„ˆë¬´ ì§§ì€ í´ë§ ì£¼ê¸° ì„¤ì • ë°©ì§€ (ìµœì†Œê°’ ê²€ì¦) | â¬œ |

### í…ŒìŠ¤íŠ¸: ì‹¤ì‹œê°„ì„± í™•ì¸

```
1. ë°© ì…ì¥ í›„ Network íƒ­ ì—´ê¸°
2. GitHubì—ì„œ ì»¤ë°‹ í‘¸ì‹œ
3. í´ë§ ì£¼ê¸°(30ì´ˆ) ë‚´ì— ì´ë²¤íŠ¸ ìˆ˜ì‹  í™•ì¸
4. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë²¤íŠ¸ í‘œì‹œ í™•ì¸
```

---

## Phase 4: í”„ë¡ íŠ¸ì—”ë“œ ì´ë²¤íŠ¸ í‘œì‹œ

| ìˆœì„œ | ì‘ì—… | í…ŒìŠ¤íŠ¸ ë°©ë²• | ìƒíƒœ |
|:---:|------|-------------|:---:|
| 11 | Socket ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (`githubEvent`) | ì½˜ì†”ì—ì„œ ì´ë²¤íŠ¸ ìˆ˜ì‹  ë¡œê·¸ í™•ì¸ | â¬œ |
| 12 | ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œ | UIì—ì„œ Push/PR ì¹´ìš´íŠ¸ í™•ì¸ | â¬œ |

### ì½”ë“œ í’ˆì§ˆ ì²´í¬

| í•­ëª© | ëª…ë ¹ì–´ | ìƒíƒœ |
|:---:|--------|:---:|
| Lint | `npm run lint` | â¬œ |
| Format | `npm run format` | â¬œ |
| Build | `npm run build` | â¬œ |
| Test | `npm run test` | â¬œ |

### ë³´ì•ˆ ì²´í¬

| í•­ëª© | í™•ì¸ ë‚´ìš© | ìƒíƒœ |
|:---:|----------|:---:|
| XSS ë°©ì§€ | GitHub ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì ì ˆíˆ ì´ìŠ¤ì¼€ì´í”„ë˜ì–´ ë Œë”ë§ë˜ëŠ”ì§€ | â¬œ |
| ë°ì´í„° ê²€ì¦ | Socketìœ¼ë¡œ ìˆ˜ì‹ í•œ ì´ë²¤íŠ¸ ë°ì´í„°ì˜ íƒ€ì…/í˜•ì‹ ê²€ì¦ | â¬œ |

### í…ŒìŠ¤íŠ¸: E2E íë¦„

```
1. ë¡œê·¸ì¸ â†’ ë°© ì…ì¥
2. GitHubì—ì„œ ì»¤ë°‹ í‘¸ì‹œ
3. 30ì´ˆ ì´ë‚´ì— í™”ë©´ì—ì„œ Push ì¹´ìš´íŠ¸ ì¦ê°€ í™•ì¸
4. PR ìƒì„± í›„ PR ì¹´ìš´íŠ¸ ì¦ê°€ í™•ì¸
```

---

## ë„¤íŠ¸ì›Œí¬ íƒ­ ë¶„ì„ ê°€ì´ë“œ

### ë°±ì—”ë“œ ë¡œê¹… ì¶”ê°€ (ì„ì‹œ)

`github.poll-service.ts`ì— ë‹¤ìŒ ë¡œê·¸ ì¶”ê°€:

```typescript
console.log('[GitHub Poll]', {
  url,
  status: res.status,
  etag: res.headers.get('ETag'),
  rateLimit: {
    limit: res.headers.get('X-RateLimit-Limit'),
    remaining: res.headers.get('X-RateLimit-Remaining'),
    used: res.headers.get('X-RateLimit-Used'),
  },
});
```

### í™•ì¸í•  ì‘ë‹µ í—¤ë”

| í—¤ë” | ì„¤ëª… | ê¸°ëŒ€ê°’ |
|------|------|--------|
| `X-RateLimit-Limit` | ì‹œê°„ë‹¹ ìµœëŒ€ ìš”ì²­ ìˆ˜ | 5000 (ì¸ì¦) |
| `X-RateLimit-Remaining` | ë‚¨ì€ ìš”ì²­ ìˆ˜ | - |
| `X-RateLimit-Used` | ì‚¬ìš©í•œ ìš”ì²­ ìˆ˜ | 304ì‹œ ì¦ê°€ ì•ˆí•¨ |
| `ETag` | ì‘ë‹µ ì‹ë³„ì | ì €ì¥í•˜ì—¬ ë‹¤ìŒ ìš”ì²­ì— ì‚¬ìš© |

### í™•ì¸í•  ìš”ì²­ í—¤ë”

| í—¤ë” | ì„¤ëª… |
|------|------|
| `Authorization` | `Bearer {access_token}` |
| `If-None-Match` | ì´ì „ ì‘ë‹µì˜ ETag ê°’ |
| `Accept` | `application/vnd.github+json` |

---

## ìƒíƒœ ë²”ë¡€

- â¬œ ëŒ€ê¸°
- ğŸ”„ ì§„í–‰ ì¤‘
- âœ… ì™„ë£Œ

---

## ì°¸ê³  ë§í¬

- [GitHub Events API](https://docs.github.com/en/rest/activity/events)
- [Conditional Requests](https://docs.github.com/en/rest/overview/resources-in-the-rest-api#conditional-requests)
- [Rate Limiting](https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting)
